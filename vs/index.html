<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tournament Bracket</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .container {
            max-width: 800px;
            width: 100%;
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h1 {
            color: #667eea;
            margin-bottom: 30px;
            text-align: center;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .setup-screen, .match-screen, .champion-screen {
            display: none;
        }

        .setup-screen.active, .match-screen.active, .champion-screen.active {
            display: block;
        }

        /* Setup Screen */
        .input-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 10px;
            color: #333;
            font-weight: 600;
            font-size: 1.1em;
        }

        textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            font-family: inherit;
            resize: vertical;
            min-height: 200px;
            transition: border-color 0.3s;
        }

        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .team-count {
            color: #667eea;
            font-weight: 600;
            margin-top: 10px;
            font-size: 1em;
        }

        .bracket-size-info {
            margin: 20px 0;
            padding: 15px;
            background: #f0f0f0;
            border-radius: 10px;
            text-align: center;
        }

        .bracket-size-info p {
            color: #333;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .proceed-btn {
            margin-top: 10px;
            padding: 10px 20px;
            background: #ff6b6b;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s;
        }

        .proceed-btn:hover {
            background: #ee5a52;
            transform: translateY(-2px);
        }

        .start-btn {
            width: 100%;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.3em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            margin-top: 20px;
        }

        .start-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 7px 20px rgba(0,0,0,0.3);
        }

        .start-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Match Screen */
        .round-info {
            text-align: center;
            margin-bottom: 30px;
            color: #667eea;
            font-size: 1.5em;
            font-weight: 700;
            text-transform: uppercase;
        }

        .match-number {
            text-align: center;
            color: #666;
            margin-bottom: 20px;
            font-size: 1.1em;
        }

        .vs-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin: 40px 0;
            animation: fadeIn 0.6s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .team-box {
            flex: 1;
            text-align: center;
            padding: 30px;
            background: #f8f9fa;
            border: 3px solid #ddd;
            border-radius: 15px;
            font-size: 1.5em;
            font-weight: 600;
            color: #333;
            transition: all 0.3s;
        }

        .team-box.winner {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
            animation: winnerPulse 0.6s ease-out;
        }

        @keyframes winnerPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .vs-text {
            font-size: 2em;
            font-weight: 700;
            color: #667eea;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .button-container {
            display: flex;
            gap: 20px;
            margin-top: 30px;
        }

        .winner-btn {
            flex: 1;
            padding: 20px;
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
        }

        .winner-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 20px rgba(76, 175, 80, 0.4);
        }

        .winner-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .next-btn {
            width: 100%;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s;
        }

        .next-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 7px 20px rgba(0,0,0,0.3);
        }

        /* Champion Screen */
        .champion-content {
            text-align: center;
            animation: championAppear 0.8s ease-out;
        }

        @keyframes championAppear {
            from {
                opacity: 0;
                transform: scale(0.8) rotateY(90deg);
            }
            to {
                opacity: 1;
                transform: scale(1) rotateY(0);
            }
        }

        .trophy {
            font-size: 5em;
            margin-bottom: 20px;
        }

        .champion-content h2 {
            color: #667eea;
            font-size: 2em;
            margin-bottom: 20px;
        }

        .champion-name {
            font-size: 2.5em;
            font-weight: 700;
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 30px;
        }

        .reset-btn {
            padding: 15px 40px;
            background: #764ba2;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s;
        }

        .reset-btn:hover {
            background: #667eea;
            transform: translateY(-2px);
        }

        .error {
            color: #e74c3c;
            padding: 15px;
            background: #fadbd8;
            border-radius: 8px;
            margin-top: 15px;
            font-weight: 600;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <!-- Setup Screen -->
            <div class="setup-screen active" id="setupScreen">
                <h1>üèÜ Tournament Setup</h1>
                
                <div class="input-group">
                    <label>Enter Team/Player Names (one per line):</label>
                    <textarea id="teamInput" placeholder="Team Alpha&#10;Team Beta&#10;Team Gamma&#10;Team Delta&#10;..."></textarea>
                    <div class="team-count" id="teamCount">Teams entered: 0</div>
                </div>

                <div class="bracket-size-info" id="bracketInfo" style="display: none;">
                    <p id="bracketMessage"></p>
                    <button class="proceed-btn" id="proceedBtn" style="display: none;">Proceed with <span id="suggestedSize"></span> teams</button>
                </div>

                <button class="start-btn" id="startBtn" onclick="startTournament()">Start Tournament</button>
                <div id="error" class="error"></div>
            </div>

            <!-- Match Screen -->
            <div class="match-screen" id="matchScreen">
                <h1>üèÜ Tournament</h1>
                <div class="round-info" id="roundInfo"></div>
                <div class="match-number" id="matchNumber"></div>

                <div class="vs-container">
                    <div class="team-box" id="team1Box"></div>
                    <div class="vs-text">VS</div>
                    <div class="team-box" id="team2Box"></div>
                </div>

                <div class="button-container">
                    <button class="winner-btn" id="team1Btn" onclick="selectWinner(1)"></button>
                    <button class="winner-btn" id="team2Btn" onclick="selectWinner(2)"></button>
                </div>

                <button class="next-btn" id="nextBtn" onclick="nextMatch()" style="display: none;">Next Match ‚Üí</button>
            </div>

            <!-- Champion Screen -->
            <div class="champion-screen" id="championScreen">
                <div class="champion-content">
                    <div class="trophy">üèÜ</div>
                    <h2>Tournament Champion!</h2>
                    <div class="champion-name" id="championName"></div>
                    <button class="reset-btn" onclick="resetTournament()">Start New Tournament</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let teams = [];
        let bracket = [];
        let currentRound = 0;
        let currentMatch = 0;
        let selectedWinner = null;

        // Load state on page load
        window.addEventListener('DOMContentLoaded', () => {
            const savedTeams = localStorage.getItem('tournamentTeams');
            const savedBracket = localStorage.getItem('tournamentBracket');
            const savedRound = localStorage.getItem('tournamentRound');
            const savedMatch = localStorage.getItem('tournamentMatch');

            if (savedTeams) {
                document.getElementById('teamInput').value = savedTeams;
                updateTeamCount();
            }

            if (savedBracket && savedRound && savedMatch) {
                teams = JSON.parse(localStorage.getItem('tournamentTeamsList'));
                bracket = JSON.parse(savedBracket);
                currentRound = parseInt(savedRound);
                currentMatch = parseInt(savedMatch);
                
                document.getElementById('setupScreen').classList.remove('active');
                document.getElementById('matchScreen').classList.add('active');
                displayMatch();
            }
        });

        // Update team count as user types
        document.getElementById('teamInput').addEventListener('input', updateTeamCount);

        function updateTeamCount() {
            const input = document.getElementById('teamInput').value;
            const teamList = input.split('\n').filter(t => t.trim() !== '');
            const count = teamList.length;
            
            document.getElementById('teamCount').textContent = `Teams entered: ${count}`;
            
            // Save to localStorage
            localStorage.setItem('tournamentTeams', input);

            // Check bracket size
            if (count > 0) {
                const bracketSizes = [4, 8, 16, 32, 64, 128];
                const perfectMatch = bracketSizes.includes(count);
                const nextSize = bracketSizes.find(size => size >= count);
                
                const bracketInfo = document.getElementById('bracketInfo');
                const bracketMessage = document.getElementById('bracketMessage');
                const proceedBtn = document.getElementById('proceedBtn');
                const suggestedSize = document.getElementById('suggestedSize');

                if (perfectMatch) {
                    bracketInfo.style.display = 'block';
                    bracketMessage.textContent = `‚úì Perfect! ${count} teams fit a standard bracket.`;
                    proceedBtn.style.display = 'none';
                } else if (nextSize) {
                    bracketInfo.style.display = 'block';
                    bracketMessage.textContent = `You have ${count} teams. Not enough for a ${nextSize}-team bracket.`;
                    const previousSize = bracketSizes[bracketSizes.indexOf(nextSize) - 1];
                    if (previousSize && count > previousSize) {
                        suggestedSize.textContent = nextSize;
                        proceedBtn.style.display = 'inline-block';
                    } else if (previousSize) {
                        suggestedSize.textContent = previousSize;
                        proceedBtn.style.display = 'inline-block';
                    }
                } else {
                    bracketInfo.style.display = 'none';
                }
            } else {
                document.getElementById('bracketInfo').style.display = 'none';
            }
        }

        // Proceed with suggested bracket size
        document.getElementById('proceedBtn').addEventListener('click', function() {
            const input = document.getElementById('teamInput').value;
            const teamList = input.split('\n').filter(t => t.trim() !== '');
            const suggestedSize = parseInt(document.getElementById('suggestedSize').textContent);
            
            if (teamList.length > suggestedSize) {
                // Remove extra teams
                const newList = teamList.slice(0, suggestedSize);
                document.getElementById('teamInput').value = newList.join('\n');
            } else {
                // Add BYE teams
                while (teamList.length < suggestedSize) {
                    teamList.push('BYE');
                }
                document.getElementById('teamInput').value = teamList.join('\n');
            }
            
            updateTeamCount();
        });

        function startTournament() {
            const input = document.getElementById('teamInput').value;
            teams = input.split('\n').filter(t => t.trim() !== '');
            const errorDiv = document.getElementById('error');

            if (teams.length < 2) {
                errorDiv.textContent = 'Please enter at least 2 teams!';
                errorDiv.style.display = 'block';
                return;
            }

            const bracketSizes = [4, 8, 16, 32, 64, 128];
            if (!bracketSizes.includes(teams.length)) {
                errorDiv.textContent = `Please enter exactly ${bracketSizes.join(', ')} teams, or use the "Proceed" button to adjust.`;
                errorDiv.style.display = 'block';
                return;
            }

            errorDiv.style.display = 'none';

            // Shuffle teams randomly
            for (let i = teams.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [teams[i], teams[j]] = [teams[j], teams[i]];
            }

            // Create bracket structure
            const rounds = Math.log2(teams.length);
            bracket = [];
            
            // First round
            const firstRound = [];
            for (let i = 0; i < teams.length; i += 2) {
                firstRound.push({
                    team1: teams[i],
                    team2: teams[i + 1],
                    winner: null
                });
            }
            bracket.push(firstRound);

            // Create empty rounds
            for (let i = 1; i < rounds; i++) {
                const roundMatches = [];
                const matchCount = Math.pow(2, rounds - i - 1);
                for (let j = 0; j < matchCount; j++) {
                    roundMatches.push({
                        team1: null,
                        team2: null,
                        winner: null
                    });
                }
                bracket.push(roundMatches);
            }

            // Auto-advance BYE matches
            bracket[0].forEach(match => {
                if (match.team1 === 'BYE') {
                    match.winner = match.team2;
                } else if (match.team2 === 'BYE') {
                    match.winner = match.team1;
                }
            });

            currentRound = 0;
            currentMatch = 0;
            
            // Save state
            localStorage.setItem('tournamentTeamsList', JSON.stringify(teams));
            saveState();

            document.getElementById('setupScreen').classList.remove('active');
            document.getElementById('matchScreen').classList.add('active');
            displayMatch();
        }

        function displayMatch() {
            // Skip BYE matches and completed matches
            while (currentRound < bracket.length) {
                const match = bracket[currentRound][currentMatch];
                
                if (!match || (match.team1 && match.team2 && match.winner)) {
                    // Move to next match
                    currentMatch++;
                    if (currentMatch >= bracket[currentRound].length) {
                        currentMatch = 0;
                        currentRound++;
                    }
                } else if (!match.team1 || !match.team2) {
                    // Not ready yet, wait
                    return;
                } else if (match.team1 === 'BYE' || match.team2 === 'BYE') {
                    // Auto-advance BYE
                    match.winner = match.team1 === 'BYE' ? match.team2 : match.team1;
                    advanceWinner();
                    currentMatch++;
                    if (currentMatch >= bracket[currentRound].length) {
                        currentMatch = 0;
                        currentRound++;
                    }
                } else {
                    break;
                }
            }

            // Check if tournament is over
            if (currentRound >= bracket.length) {
                showChampion();
                return;
            }

            const match = bracket[currentRound][currentMatch];
            
            // Display round info
            const roundNames = ['Final', 'Semi-Finals', 'Quarter-Finals'];
            const roundsFromEnd = bracket.length - currentRound - 1;
            let roundName = roundsFromEnd < roundNames.length ? roundNames[roundsFromEnd] : `Round ${currentRound + 1}`;
            
            document.getElementById('roundInfo').textContent = roundName;
            document.getElementById('matchNumber').textContent = `Match ${currentMatch + 1} of ${bracket[currentRound].length}`;

            // Display teams
            document.getElementById('team1Box').textContent = match.team1;
            document.getElementById('team2Box').textContent = match.team2;
            document.getElementById('team1Box').classList.remove('winner');
            document.getElementById('team2Box').classList.remove('winner');

            // Set button text
            document.getElementById('team1Btn').textContent = `${match.team1} Wins`;
            document.getElementById('team2Btn').textContent = `${match.team2} Wins`;
            document.getElementById('team1Btn').disabled = false;
            document.getElementById('team2Btn').disabled = false;

            document.getElementById('nextBtn').style.display = 'none';
            selectedWinner = null;

            saveState();
        }

        function selectWinner(teamNum) {
            const match = bracket[currentRound][currentMatch];
            selectedWinner = teamNum === 1 ? match.team1 : match.team2;
            match.winner = selectedWinner;

            // Visual feedback
            if (teamNum === 1) {
                document.getElementById('team1Box').classList.add('winner');
                document.getElementById('team2Box').classList.remove('winner');
            } else {
                document.getElementById('team2Box').classList.add('winner');
                document.getElementById('team1Box').classList.remove('winner');
            }

            // Disable buttons and show next
            document.getElementById('team1Btn').disabled = true;
            document.getElementById('team2Btn').disabled = true;
            document.getElementById('nextBtn').style.display = 'block';

            advanceWinner();
            saveState();
        }

        function advanceWinner() {
            const match = bracket[currentRound][currentMatch];
            
            if (currentRound < bracket.length - 1) {
                const nextMatchIndex = Math.floor(currentMatch / 2);
                const nextMatch = bracket[currentRound + 1][nextMatchIndex];
                
                if (currentMatch % 2 === 0) {
                    nextMatch.team1 = match.winner;
                } else {
                    nextMatch.team2 = match.winner;
                }
            }
        }

        function nextMatch() {
            currentMatch++;
            
            if (currentMatch >= bracket[currentRound].length) {
                currentMatch = 0;
                currentRound++;
            }

            displayMatch();
        }

        function showChampion() {
            const champion = bracket[bracket.length - 1][0].winner;
            
            document.getElementById('matchScreen').classList.remove('active');
            document.getElementById('championScreen').classList.add('active');
            document.getElementById('championName').textContent = champion;

            // Clear localStorage
            localStorage.removeItem('tournamentBracket');
            localStorage.removeItem('tournamentRound');
            localStorage.removeItem('tournamentMatch');
            localStorage.removeItem('tournamentTeamsList');
        }

        function saveState() {
            localStorage.setItem('tournamentBracket', JSON.stringify(bracket));
            localStorage.setItem('tournamentRound', currentRound);
            localStorage.setItem('tournamentMatch', currentMatch);
        }

        function resetTournament() {
            teams = [];
            bracket = [];
            currentRound = 0;
            currentMatch = 0;
            selectedWinner = null;

            localStorage.removeItem('tournamentBracket');
            localStorage.removeItem('tournamentRound');
            localStorage.removeItem('tournamentMatch');
            localStorage.removeItem('tournamentTeamsList');

            document.getElementById('championScreen').classList.remove('active');
            document.getElementById('setupScreen').classList.add('active');
            document.getElementById('teamInput').value = '';
            updateTeamCount();
        }
    </script>
</body>
</html>