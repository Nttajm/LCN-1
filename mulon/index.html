<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mulon - Prediction Markets</title>
  <link rel="stylesheet" href="css/main.css">
  <link rel="stylesheet" href="css/index.css">
  <link rel="stylesheet" href="css/onboarding.css">
  <link rel="stylesheet" href="../css/standard.css">
</head>
<body>
  <!-- Onboarding/Tutorial Overlay -->
  <div class="onboarding-overlay" id="onboardingOverlay">
    <!-- Segment 0: From the Creator -->
    <div class="onboarding-segment intro-segment active" data-segment="0">
      <div class="onboarding-content intro-content">
        <p class="intro-text">From the creator of</p>
        <img src="assets/ou-logo-white-w.png" alt="Over Under" class="intro-logo-img">
        <p class="intro-subtext">comes something new...</p>
      </div>
    </div>

    <!-- Segment 1: Welcome & Sign In -->
    <div class="onboarding-segment" data-segment="1">
      <div class="onboarding-content">
        <div class="onboarding-logo">
          <h1>Mulon</h1>
          <p class="tagline">Predict the future. Trade on outcomes.</p>
        </div>
        
        <div class="onboarding-actions">
          <button class="google-signin-btn" id="googleSignInBtn">
            <svg viewBox="0 0 24 24" width="20" height="20">
              <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
              <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
              <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
              <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
            </svg>
            <span>Continue with Google (OverUnderTHS link)</span>
          </button> 
          
          <button class="skip-btn" id="skipSignInBtn">
            Browse as Guest
          </button>
        </div>
        
        <p class="onboarding-note">Sign in to save your portfolio & trades</p>
      </div>
    </div>

    <!-- Segment 2: What is Mulon -->
    <div class="onboarding-segment" data-segment="2">
      <div class="onboarding-content">
        <div class="segment-header">
          <span class="segment-number">1/4</span>
          <h2>What is Mulon?</h2>
        </div>
        
        <div class="explanation-card">
          <div class="explanation-icon">üéØ</div>
          <h3>Prediction Markets</h3>
          <p>Trade on the outcome of real events. If you think something will happen, buy <span class="highlight-yes">Yes</span>. If not, buy <span class="highlight-no">No</span>.</p>
        </div>
        
        <div class="example-box">
          <p class="example-question">"Will the cafeteria serve pizza Monday?"</p>
          <div class="example-prices">
            <span class="yes-price">Yes 75¬¢</span>
            <span class="no-price">No 25¬¢</span>
          </div>
          <p class="example-explain">75% of traders think yes!</p>
        </div>
        
        <button class="next-btn" data-next="3">Next ‚Üí</button>
      </div>
    </div>

    <!-- Segment 3: How Prices Work -->
    <div class="onboarding-segment" data-segment="3">
      <div class="onboarding-content">
        <div class="segment-header">
          <span class="segment-number">2/4</span>
          <h2>How Prices Work</h2>
        </div>
        
        <div class="explanation-card">
          <div class="explanation-icon">üìà</div>
          <h3>Price = Probability</h3>
          <p>Prices are set by <strong>supply and demand</strong>. No algorithms. No house setting lines. Just traders reacting to information.</p>
        </div>
        
        <div class="price-demo">
          <div class="price-step">
            <span class="step-label">Current</span>
            <div class="step-price">Yes 30¬¢</div>
            <span class="step-note">~30% chance</span>
          </div>
          <div class="price-arrow">‚Üí</div>
          <div class="price-step">
            <span class="step-label">News drops</span>
            <div class="step-price buying">People buy</div>
          </div>
          <div class="price-arrow">‚Üí</div>
          <div class="price-step">
            <span class="step-label">After</span>
            <div class="step-price high">Yes 55¬¢</div>
            <span class="step-note">~55% chance</span>
          </div>
        </div>
        
        <button class="next-btn" data-next="4">Next ‚Üí</button>
      </div>
    </div>

    <!-- Segment 4: Price Impact Example -->
    <div class="onboarding-segment" data-segment="4">
      <div class="onboarding-content">
        <div class="segment-header">
          <span class="segment-number">3/4</span>
          <h2>Your Trades Move Prices</h2>
        </div>
        
        <div class="trade-example">
          <div class="trade-header">
            <span class="trade-market">üçï "Will pizza be served Monday?"</span>
            <div class="trade-current">
              <span>Yes <strong>82¬¢</strong></span>
              <span class="divider">|</span>
              <span>No <strong>18¬¢</strong></span>
              <span class="volume">$850 Vol.</span>
            </div>
          </div>
          
          <div class="trade-action">
            <span class="action-label">You buy $100 of Yes:</span>
          </div>
          
          <div class="trade-breakdown">
            <div class="breakdown-item">
              <span class="breakdown-label">Impact</span>
              <span class="breakdown-value">100/850 = <strong>11.7%</strong></span>
            </div>
            <div class="breakdown-item">
              <span class="breakdown-label">Price moves</span>
              <span class="breakdown-value">82¬¢ ‚Üí <strong class="highlight-green">94¬¢</strong></span>
            </div>
            <div class="breakdown-item">
              <span class="breakdown-label">You get</span>
              <span class="breakdown-value">$100 √∑ $0.82 = <strong>~122 shares</strong></span>
            </div>
            <div class="breakdown-item highlight-row">
              <span class="breakdown-label">If correct</span>
              <span class="breakdown-value">122 √ó $1 = <strong class="profit">$122 profit</strong></span>
            </div>
          </div>
        </div>
        
        <button class="next-btn" data-next="5">Next ‚Üí</button>
      </div>
    </div>

    <!-- Segment 5: Get Started -->
    <div class="onboarding-segment" data-segment="5">
      <div class="onboarding-content">
        <div class="segment-header">
          <span class="segment-number">4/4</span>
          <h2>Ready to Trade?</h2>
        </div>
        
        <div class="final-tips">
          <div class="tip-item">
            <span class="tip-icon">üí∞</span>
            <div class="tip-text">
              <strong>Start with $500</strong>
              <p>Virtual money to practice trading</p>
            </div>
          </div>
          <div class="tip-item">
            <span class="tip-icon">üìä</span>
            <div class="tip-text">
              <strong>Watch the markets</strong>
              <p>Prices change as people trade</p>
            </div>
          </div>
          <div class="tip-item">
            <span class="tip-icon">üèÜ</span>
            <div class="tip-text">
              <strong>Make predictions</strong>
              <p>Buy Yes or No on any market</p>
            </div>
          </div>
        </div>
        
        <button class="start-trading-btn" id="startTradingBtn">
          Start Trading
        </button>
      </div>
    </div>

    <!-- Progress Dots -->
    <div class="onboarding-progress" id="onboardingProgress">
      <span class="progress-dot" data-segment="1"></span>
      <span class="progress-dot" data-segment="2"></span>
      <span class="progress-dot" data-segment="3"></span>
      <span class="progress-dot" data-segment="4"></span>
      <span class="progress-dot" data-segment="5"></span>
    </div>
  </div>

  <!-- Sign In Required Modal -->
  <div class="signin-required-modal" id="signinRequiredModal">
    <div class="signin-modal-content">
      <h3>Sign in to Trade</h3>
      <p>You need to sign in to buy contracts.</p>
      <button class="google-signin-btn" id="modalSignInBtn">
        <svg viewBox="0 0 24 24" width="20" height="20">
          <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
          <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
          <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
          <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
        </svg>
        <span>Sign in with Google</span>
      </button>
      <button class="cancel-btn" id="cancelSignInBtn">Cancel</button>
    </div>
  </div>

  <!-- Over Under Sync Modal -->
  <div class="ou-sync-modal" id="ouSyncModal">
    <div class="ou-sync-content">
      <div class="ou-sync-logo">
        <img src="assets/ou-logo-white-w.png" alt="Over Under">
      </div>
      <h3>Welcome back!</h3>
      <p class="ou-sync-message">We see you have an Over Under account. Would you like to sync your username?</p>
      <div class="ou-sync-username" id="ouSyncUsername"></div>
      <div class="ou-sync-actions">
        <button class="ou-sync-btn yes" id="ouSyncYes">Yes, use this name</button>
        <button class="ou-sync-btn no" id="ouSyncNo">No thanks</button>
      </div>
    </div>
  </div>

  <!-- Header -->
  <header class="header">
    <div class="header-left">
      <button class="sidebar-toggle" id="sidebarToggle" aria-label="Toggle sidebar">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="3" y1="12" x2="21" y2="12"></line>
          <line x1="3" y1="6" x2="21" y2="6"></line>
          <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
      </button>
      <a href="index.html" class="logo">
        <span class="logo-text">Mulon (beta)</span>
      </a>
      <div class="search-box">
        <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="11" cy="11" r="8"></circle>
          <path d="m21 21-4.3-4.3"></path>
        </svg>
        <input type="text" placeholder="Search markets...">
      </div>
    </div>
    <div class="header-right">
      <div class="balance-display">
        <div class="balance-item">
          <span class="balance-label">Balance</span>
          <span class="balance-amount" id="userBalance" data-format="balance" data-amount="500">$500.00</span>
        </div>
        <div class="balance-divider"></div>
        <div class="balance-item">
          <span class="balance-label">Portfolio</span>
          <span class="balance-amount portfolio-value" id="portfolioValue" data-format="balance" data-amount="0">$0.00</span>
        </div>
        <div class="balance-divider"></div>
        <div class="balance-item keys-item">
          <span class="balance-label">Keys <span class="keys-info-btn" id="keysInfoBtn">?</span></span>
          <span class="balance-amount keys-amount" id="userKeys"><img src="/bp/EE/assets/ouths/key.png" alt="" class="key-icon"> 15</span>
          <div class="keys-tooltip" id="keysTooltip">
            <h4><img src="/bp/EE/assets/ouths/key.png" alt="" class="key-icon"> Keys</h4>
            <p>Keys are a special currency that can be used for:</p>
            <ul>
              <li>Playing casino games</li>
              <li>Buying collectables</li>
            </ul>
            <p style="margin-top: 8px;"><strong>Earn Keys:</strong></p>
            <ul>
              <li>+10 keys for every winning prediction</li>
              <li>+3 keys per day (daily login)</li>
            </ul>
          </div>
        </div>
      </div>
      <!-- JoePay Notification Bell -->
      <div class="joepay-notification" id="joepayNotification">
        <button class="notification-bell" id="notificationBell" title="JoePay Notifications">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
            <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
          </svg>
          <span class="notification-badge" id="notificationBadge" style="display: none;">0</span>
        </button>
      </div>
      <div class="user-menu" id="userMenu">
        <div class="user-avatar" id="userAvatar">
          <span id="userInitials">?</span>
        </div>
        <div class="user-dropdown" id="userDropdown">
          <div class="user-info" id="userInfo">
            <span class="user-name" id="userName">Guest</span>
            <span class="user-email" id="userEmail">Not signed in</span>
          </div>
          <div class="dropdown-divider"></div>
          <button class="dropdown-item" id="editProfileBtn" style="display: none;">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
              <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
            </svg>
            Edit Profile
          </button>
          <button class="dropdown-item" id="signOutBtn" style="display: none;">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
              <polyline points="16 17 21 12 16 7"></polyline>
              <line x1="21" y1="12" x2="9" y2="12"></line>
            </svg>
            Sign Out
          </button>
          <button class="dropdown-item signin" id="headerSignInBtn">
            <svg viewBox="0 0 24 24" width="16" height="16">
              <path fill="currentColor" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/>
            </svg>
            Sign In
          </button>
        </div>
      </div>
    </div>
  </header>

  <!-- Sidebar -->
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <div class="sidebar-tabs">
        <button class="sidebar-tab active" data-tab="watchlist">Watchlist</button>
        <button class="sidebar-tab" data-tab="portfolio">Portfolio</button>
        <button class="sidebar-tab" data-tab="cashouts">Cash Outs</button>
      </div>
    </div>
    
    <div class="sidebar-content">
      <!-- Watchlist Tab -->
      <div class="sidebar-panel active" id="watchlistPanel">
        <div class="empty-sidebar" id="emptyWatchlist">
          <div class="empty-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path>
              <line x1="4" y1="4" x2="20" y2="20"></line>
            </svg>
          </div>
          <p>No bookmarked items</p>
          <span class="empty-hint">Click the bookmark icon on any market</span>
        </div>
        <div class="sidebar-list" id="watchlistItems"></div>
      </div>
      
      <!-- Portfolio Tab -->
      <div class="sidebar-panel" id="portfolioPanel">
        <div class="portfolio-summary">
          <div class="portfolio-stat">
            <span class="stat-label">Total Value</span>
            <span class="stat-value" id="totalValue" data-format="balance" data-amount="500">$500.00</span>
          </div>
          <div class="portfolio-stat">
            <span class="stat-label">Total P&L</span>
            <span class="stat-value pnl-positive" id="totalPnl" data-format="currency" data-amount="0">+$0.00</span>
          </div>
        </div>
        
        <div class="positions-header">
          <span>Your Positions</span>
          <span class="position-count" id="positionCount">0</span>
        </div>
        
        <div class="empty-sidebar" id="emptyPortfolio">
          <div class="empty-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
              <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
            </svg>
          </div>
          <p>No positions yet</p>
          <span class="empty-hint">Buy Yes or No on any market to start</span>
        </div>
        
        <div class="positions-list" id="positionsList"></div>
      </div>
      
      <!-- Cash Outs Tab -->
      <div class="sidebar-panel" id="cashoutsPanel">
        <div class="cashouts-summary">
          <div class="portfolio-stat">
            <span class="stat-label">Total Won</span>
            <span class="stat-value cashout-won" id="totalWon" data-format="balance" data-amount="0">$0.00</span>
          </div>
          <div class="portfolio-stat">
            <span class="stat-label">Total Lost</span>
            <span class="stat-value cashout-lost" id="totalLost" data-format="balance" data-amount="0">$0.00</span>
          </div>
        </div>
        
        <div class="positions-header">
          <span>Resolved Positions</span>
          <span class="position-count" id="cashoutCount">0</span>
        </div>
        
        <div class="empty-sidebar" id="emptyCashouts">
          <div class="empty-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <circle cx="12" cy="12" r="10"></circle>
              <path d="M16 8l-4 4-4-4"></path>
              <path d="M12 12v6"></path>
            </svg>
          </div>
          <p>No resolved positions yet</p>
          <span class="empty-hint">Your winnings will appear here</span>
        </div>
        
        <div class="cashouts-list" id="cashoutsList"></div>
      </div>
    </div>
  </aside>
  
  <!-- Sidebar Overlay for mobile -->
  <div class="sidebar-overlay" id="sidebarOverlay"></div>

  <!-- Navigation Categories -->
  <nav class="nav">
    <div class="nav-inner">
      <ul class="nav-links">
        <li><a href="index.html" class="nav-link">Home</a></li>
        <li><a href="index.html?cat=all" class="nav-link">All Markets</a></li>
        <li><a href="marketplace.html" class="nav-link">Marketplace</a></li>
        <li><a href="leaderbaord.html" class="nav-link">Leaderboard</a></li>
        <li><a href="casino.html" class="nav-link">Casino</a></li>
        <li><a href="apps.html" class="nav-link">Apps</a></li>
      </ul>
      <div class="nav-divider"></div>
      <ul class="nav-categories" id="navCategories">
        <!-- Categories loaded dynamically from Firebase -->
      </ul>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="main-content">
    <!-- New Features Banner -->
    <div class="new-features-banner">
      <div class="banner-sparkle">‚ú®</div>
      <div class="banner-content">
        <span class="banner-new-badge">NEW</span>
        <span class="banner-text">
          <strong>üêé Horse Racing</strong>, <strong>‚úä Rock Paper Scissors</strong>, and <strong>üí∏ JoePay</strong> are now live!
        </span>
      </div>
      <a href="casino.html" class="banner-cta">Try Now ‚Üí</a>
    </div>

    <!-- The Great Reset Countdown -->
    <div class="daily-key-box">
      <span>
        25 key reward for any bug reports on the discord. 
      </span>
    </div>

    <div class="daily-key-box">
      <span>
        Stay tuned for the stock market: Mulonhood.
      </span>
    </div>
    <!-- Daily Reward Claim Box -->
    <div class="daily-key-box" id="dailyKeyBox" style="display: none;">
      <div class="daily-key-content">
        <div class="daily-key-icon">
          <span class="streak-flame" id="streakFlame">üî•</span>
          <span class="streak-count" id="streakCount">0</span>
        </div>
        <div class="daily-key-info">
          <h3 class="daily-key-title">Daily Reward</h3>
          <p class="daily-key-desc" id="dailyKeyDesc">Claim your free rewards!</p>
          <div class="reward-preview" id="rewardPreview">
            <span class="reward-item keys"><img src="/bp/EE/assets/ouths/key.png" alt="" class="mini-key-icon">+<span id="previewKeys">3</span></span>
            <span class="reward-item balance">+$<span id="previewBalance" data-format="money" data-amount="150">150.00</span></span>
            <span class="reward-multiplier" id="rewardMultiplier">1.0x</span>
          </div>
        </div>
        <button class="daily-key-btn" id="claimDailyKeyBtn">
          <span class="claim-text">Claim Rewards</span>
        </button>
        <div class="daily-key-timer" id="dailyKeyTimer" style="display: none;">
          <span class="timer-label">Next reward in:</span>
          <span class="timer-value" id="timerValue">00:00:00</span>
        </div>
      </div>
    </div>

    <!-- Featured/Trending Section -->
    <section class="section">
      <div class="section-header">
        <h2 class="section-title">üî• Trending Markets</h2>
        <a href="index.html?cat=all" class="see-all">See all ‚Üí</a>
      </div>
      
      <!-- Featured cards rendered dynamically -->
      <div id="featuredContainer"></div>
    </section>

    <!-- Market Grid -->
    <section class="section">
      <div class="section-header">
        <h2 class="section-title">üìä All Markets</h2>
      </div>
      
      <div class="market-grid" id="marketGrid">
        <!-- Market cards rendered dynamically -->
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="footer">
    <div class="footer-inner">
      <span class="footer-logo">Mulon</span>
      <span class="footer-text">¬© 2026 Mulon Markets. For educational use only.</span>
      <div class="footer-buttons">
        <button class="suggest-btn" id="suggestBtn">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 5v14M5 12h14"/>
          </svg>
          Suggest a Market
        </button>
        <a href="https://discord.gg/gvSFgDEGtb" target="_blank" class="discord-btn">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028 14.09 14.09 0 0 0 1.226-1.994.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128 10.2 10.2 0 0 0 .372-.292.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.956-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.955-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.946 2.418-2.157 2.418z"/>
          </svg>
          Feedback
        </a>
        <a href="admin.html" class="report-btn">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"></path>
            <line x1="4" y1="22" x2="4" y2="15"></line>
          </svg>
          Report
        </a>
      </div>
    </div>
  </footer>

  <!-- Suggestion Modal -->
  <div class="modal-overlay" id="suggestModal">
    <div class="modal suggest-modal">
      <button class="modal-close" id="closeSuggestModal">√ó</button>
      <h3>üí° Suggest a Market</h3>
      <p class="suggest-subtitle">Have an idea for a prediction? Let us know!</p>
      <form id="suggestForm">
        <div class="form-group">
          <label for="suggestTitle">Market Question *</label>
          <input type="text" id="suggestTitle" placeholder="e.g., Will the cafeteria serve pizza on Friday?" required>
        </div>
        <div class="form-group">
          <label for="suggestCategory">Category</label>
          <select id="suggestCategory">
            <option value="">Select a category (optional)</option>
          </select>
        </div>
        <div class="form-group">
          <label for="suggestReason">Why should we add this?</label>
          <textarea id="suggestReason" rows="3" placeholder="Tell us why this would be interesting..."></textarea>
        </div>
        <button type="submit" class="btn btn-primary suggest-submit">Submit Suggestion</button>
      </form>
    </div>
  </div>

  <!-- Bet Modal -->
  <div class="modal-overlay" id="betModal">
    <div class="modal">
      <button class="modal-close" id="closeModal">√ó</button>
      
      <div class="modal-header">
        <div class="modal-market-icon">üìù</div>
        <div class="modal-market-info">
          <h3 class="modal-market-title" id="modalTitle">When will Torre grade the next exam?</h3>
          <p class="modal-market-subtitle">Buy <span id="modalChoice" class="choice-yes">Yes</span> ¬∑ <span id="modalOutcome">Before Feb 1st</span></p>
        </div>
      </div>

      <div class="modal-tabs">
        <button class="modal-tab active" data-tab="buy">Buy</button>
        <div class="modal-currency">
          Dollars <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"></polyline></svg>
        </div>
      </div>

      <div class="modal-price-buttons">
        <button class="price-btn yes active" id="priceYes">
          <span>Yes</span>
          <span class="price-value" id="yesPrice">69¬¢</span>
        </button>
        <button class="price-btn no" id="priceNo">
          <span>No</span>
          <span class="price-value" id="noPrice">31¬¢</span>
        </button>
      </div>

      <div class="modal-amount">
        <div class="amount-header">
          <span class="amount-label">Dollars</span>
          <span class="amount-interest">Earn 3.25% Interest</span>
        </div>
        <div class="amount-input-wrapper">
          <span class="amount-symbol">$</span>
          <input type="number" class="amount-input" id="amountInput" value="1" min="1" max="500">
        </div>
      </div>

      <div class="modal-info">
        <div class="info-row">
          <span class="info-label">Shares</span>
          <span class="info-value" id="sharesValue">0</span>
        </div>
        <div class="info-row">
          <span class="info-label">Current Price</span>
          <span class="info-value" id="oddsValue">69¬¢</span>
        </div>
        <div class="info-row">
          <span class="info-label">Est. Price After</span>
          <span class="info-value" id="priceAfterValue">69¬¢</span>
        </div>
        <div class="info-row highlight">
          <span class="info-label">Payout if Correct</span>
          <span class="info-value payout-value" id="payoutValue" data-format="balance" data-amount="0">$0.00</span>
        </div>
      </div>
      
      <div class="price-impact-notice" id="priceImpactNotice">
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="12" y1="16" x2="12" y2="12"></line>
          <line x1="12" y1="8" x2="12.01" y2="8"></line>
        </svg>
        <span>Your trade will move the market price</span>
      </div>

      <button class="modal-buy-btn" id="buyBtn">Buy</button>
    </div>
  </div>

  <!-- Beta Notice Modal -->
  <div class="modal-overlay" id="betaModal">
    <div class="modal beta-modal">
      <div class="beta-modal-content">
        <div class="beta-badge">üß™ BETA</div>
        <h2>Welcome, Beta Tester!</h2>
        
        <div class="beta-info">
          <p>Mulon is currently in <strong>beta testing</strong>. Here's what you should know:</p>
          
          <div class="beta-point">
            <span class="beta-icon">üí∞</span>
            <div>
              <strong>Free Money for Testing</strong>
              <p>You'll receive money periodically so you can test all features without worry.</p>
            </div>
          </div>
          
          <div class="beta-point">
            <span class="beta-icon">üîÑ</span>
            <div>
              <strong>Full Reset at Launch</strong>
              <p>When Mulon officially launches, all balances will be reset to <strong data-format="balance" data-amount="1000">$1,000.00</strong> with <strong>60 keys</strong>.</p>
            </div>
          </div>
          
          <div class="beta-point">
            <span class="beta-icon">üêõ</span>
            <div>
              <strong>Help Us Improve</strong>
              <p>Report bugs, suggest features, and help make Mulon the best prediction market!</p>
            </div>
          </div>
        </div>
        
        <p class="beta-thanks">Thank you for being an early tester! üéâ</p>
        
        <button class="btn btn-primary beta-dismiss-btn" id="dismissBetaBtn">Got it, let's trade!</button>
      </div>
    </div>
  </div>

  <!-- Profile Edit Modal -->
  <div class="modal-overlay" id="profileModal">
    <div class="modal profile-modal">
      <button class="modal-close" id="closeProfileModal">√ó</button>
      <h3>üë§ Edit Profile</h3>
      
      <div class="profile-avatar-section">
        <div class="profile-avatar-preview" id="profileAvatarPreview">
          <span id="profilePreviewInitials">?</span>
          <img id="profilePreviewPhoto" src="" alt="" style="display: none;">
        </div>
        <p class="profile-avatar-hint">Choose your avatar style</p>
      </div>
      
      <div class="avatar-options" id="avatarOptions">
        <button class="avatar-option" data-avatar="default" title="Default (Google Photo)">
          <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="8" r="4"></circle>
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
          </svg>
        </button>
        <button class="avatar-option" data-avatar="gradient1" title="Purple Gradient">
          <div class="avatar-gradient" style="background: linear-gradient(135deg, #667eea, #764ba2);"></div>
        </button>
        <button class="avatar-option" data-avatar="gradient2" title="Ocean">
          <div class="avatar-gradient" style="background: linear-gradient(135deg, #11998e, #38ef7d);"></div>
        </button>
        <button class="avatar-option" data-avatar="gradient3" title="Sunset">
          <div class="avatar-gradient" style="background: linear-gradient(135deg, #fc4a1a, #f7b733);"></div>
        </button>
        <button class="avatar-option" data-avatar="gradient4" title="Royal">
          <div class="avatar-gradient" style="background: linear-gradient(135deg, #141e30, #243b55);"></div>
        </button>
        <button class="avatar-option" data-avatar="gradient5" title="Cotton Candy">
          <div class="avatar-gradient" style="background: linear-gradient(135deg, #ff9a9e, #fecfef);"></div>
        </button>
        <button class="avatar-option" data-avatar="gradient6" title="Emerald">
          <div class="avatar-gradient" style="background: linear-gradient(135deg, #00c853, #00e676);"></div>
        </button>
        <button class="avatar-option" data-avatar="gradient7" title="Midnight">
          <div class="avatar-gradient" style="background: linear-gradient(135deg, #232526, #414345);"></div>
        </button>
      </div>
      
      <div class="form-group">
        <label for="profileUsername">Display Name</label>
        <input type="text" id="profileUsername" placeholder="Enter your display name" maxlength="20">
        <span class="input-hint">This will appear on the leaderboard</span>
      </div>
      
      <div class="profile-actions">
        <button class="btn btn-secondary" id="cancelProfileBtn">Cancel</button>
        <button class="btn btn-primary" id="saveProfileBtn">Save Changes</button>
      </div>
    </div>
  </div>

  <!-- Win Celebration Modal -->
  <div class="win-celebration-overlay" id="winCelebrationOverlay">
    <div class="confetti-container" id="confettiContainer"></div>
    <div class="win-modal" id="winModal">
      <div class="win-modal-header">
        <span class="win-trophy">üèÜ</span>
        <h2>You Won!</h2>
      </div>
      <div class="win-modal-body" id="winModalBody">
        <!-- Win items added dynamically -->
      </div>
      <button class="win-modal-btn" id="winModalOkBtn">Awesome!</button>
    </div>
  </div>

  <!-- JoePay Notifications Modal -->
  <div class="modal-overlay" id="joepayModal">
    <div class="modal joepay-modal">
      <button class="modal-close" id="closeJoepayModal">√ó</button>
      <div class="joepay-modal-header">
        <div class="joepay-logo">
          <span style="font-size: 24px; color: #00D632;">üí∏</span>
          <span style="font-weight: 700; color: #00D632;">JoePay</span>
        </div>
        <a href="apps/joePay.html" class="joepay-open-btn">Open JoePay</a>
      </div>
      <div class="joepay-transactions" id="joepayTransactions">
        <div class="joepay-empty">
          <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
            <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
          </svg>
          <p>No JoePay notifications</p>
          <span>Payments you receive will appear here</span>
        </div>
      </div>
    </div>
  </div>

  <script src="js/format-utils.js"></script>
  <script src="js/money-formatter.js"></script>
  <script type="module" src="js/data-a.js"></script>
  <script type="module" src="js/index-a.js"></script>
  
  <!-- JoePay Notification System -->
  <script type="module">
    import { getFirestore, collection, query, where, orderBy, onSnapshot, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
    import { initializeApp, getApps } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";

    // Use existing Firebase app or initialize
    const firebaseConfig = {
      apiKey: "AIzaSyAGcg43F94bWqUuyLH-AjghrAfduEVQ8ZM",
      authDomain: "overunder-ths.firebaseapp.com",
      projectId: "overunder-ths",
      storageBucket: "overunder-ths.firebasestorage.app",
      messagingSenderId: "690530120785",
      appId: "1:690530120785:web:36dc297cb517ac76cb7470"
    };

    const app = getApps().length > 0 ? getApps()[0] : initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);
    
    const joePayTransactionsRef = collection(db, "joepay_transactions");
    
    let currentUserId = null;
    let unsubscribeJoePay = null;
    let seenTransactionIds = new Set();
    let allTransactions = [];
    
    // Load seen transactions from localStorage
    function loadSeenTransactions() {
      const stored = localStorage.getItem('joepay_seen_transactions');
      if (stored) {
        seenTransactionIds = new Set(JSON.parse(stored));
      }
    }
    
    // Save seen transactions to localStorage
    function saveSeenTransactions() {
      localStorage.setItem('joepay_seen_transactions', JSON.stringify([...seenTransactionIds]));
    }
    
    // Format currency
    function formatCurrency(amount) {
      return '$' + amount.toLocaleString('en-US', {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
      });
    }
    
    // Format date
    function formatDate(timestamp) {
      if (!timestamp) return '';
      const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp);
      const now = new Date();
      const diff = now - date;
      
      // Less than 1 hour
      if (diff < 3600000) {
        const mins = Math.floor(diff / 60000);
        return mins <= 1 ? 'Just now' : `${mins}m ago`;
      }
      // Less than 24 hours
      if (diff < 86400000) {
        const hours = Math.floor(diff / 3600000);
        return `${hours}h ago`;
      }
      // Otherwise show date
      return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
    }
    
    // Update notification badge
    function updateNotificationBadge() {
      const badge = document.getElementById('notificationBadge');
      if (!badge) return;
      
      // Count unseen received transactions
      const unseenCount = allTransactions.filter(tx => 
        tx.type === 'received' && !seenTransactionIds.has(tx.id)
      ).length;
      
      if (unseenCount > 0) {
        badge.style.display = 'flex';
        badge.textContent = unseenCount > 99 ? '99+' : unseenCount;
      } else {
        badge.style.display = 'none';
      }
    }
    
    // Render transactions in modal
    function renderJoePayTransactions() {
      const container = document.getElementById('joepayTransactions');
      if (!container) return;
      
      if (allTransactions.length === 0) {
        container.innerHTML = `
          <div class="joepay-empty">
            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
              <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
            </svg>
            <p>No JoePay notifications</p>
            <span>Payments you receive will appear here</span>
          </div>
        `;
        return;
      }
      
      container.innerHTML = allTransactions.map(tx => {
        const isNew = tx.type === 'received' && !seenTransactionIds.has(tx.id);
        const icon = tx.type === 'received' 
          ? '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12l7 7 7-7"/></svg>'
          : '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 19V5M5 12l7-7 7 7"/></svg>';
        
        return `
          <div class="joepay-tx-item ${isNew ? 'joepay-tx-new' : ''}" data-tx-id="${tx.id}">
            <div class="joepay-tx-icon ${tx.type}">
              ${icon}
            </div>
            <div class="joepay-tx-details">
              <div class="joepay-tx-name">${tx.type === 'received' ? 'From' : 'To'} ${tx.userName}</div>
              <div class="joepay-tx-note">${tx.note || formatDate(tx.timestamp)}</div>
            </div>
            <div class="joepay-tx-amount ${tx.type}">
              ${tx.type === 'received' ? '+' : '-'}${formatCurrency(tx.amount)}
            </div>
          </div>
        `;
      }).join('');
    }
    
    // Mark transactions as seen
    function markTransactionsAsSeen() {
      allTransactions.forEach(tx => {
        if (tx.type === 'received') {
          seenTransactionIds.add(tx.id);
        }
      });
      saveSeenTransactions();
      updateNotificationBadge();
    }
    
    // Listen to JoePay transactions
    function listenToJoePayTransactions() {
      if (unsubscribeJoePay) {
        unsubscribeJoePay();
      }
      
      if (!currentUserId) return;
      
      unsubscribeJoePay = onSnapshot(
        query(joePayTransactionsRef, orderBy('timestamp', 'desc')),
        (snapshot) => {
          allTransactions = [];
          snapshot.forEach((doc) => {
            const tx = doc.data();
            // Only show transactions involving current user
            if (tx.senderId === currentUserId || tx.receiverId === currentUserId) {
              const isSent = tx.senderId === currentUserId;
              allTransactions.push({
                id: doc.id,
                type: isSent ? 'sent' : 'received',
                userName: isSent ? tx.receiverName : tx.senderName,
                userTag: isSent ? tx.receiverTag : tx.senderTag,
                amount: tx.amount,
                note: tx.note || '',
                timestamp: tx.timestamp,
                status: tx.status || 'completed'
              });
            }
          });
          
          // Limit to last 20 transactions
          allTransactions = allTransactions.slice(0, 20);
          
          updateNotificationBadge();
          
          // If modal is open, update it
          const modal = document.getElementById('joepayModal');
          if (modal && modal.classList.contains('active')) {
            renderJoePayTransactions();
          }
        },
        (error) => {
          console.error('Error listening to JoePay transactions:', error);
        }
      );
    }
    
    // Setup event listeners
    function setupJoePayNotifications() {
      loadSeenTransactions();
      
      const bellBtn = document.getElementById('notificationBell');
      const modal = document.getElementById('joepayModal');
      const closeBtn = document.getElementById('closeJoepayModal');
      
      if (bellBtn) {
        bellBtn.addEventListener('click', () => {
          if (modal) {
            modal.classList.add('active');
            renderJoePayTransactions();
            // Mark as seen after a short delay
            setTimeout(markTransactionsAsSeen, 500);
          }
        });
      }
      
      if (closeBtn) {
        closeBtn.addEventListener('click', () => {
          if (modal) modal.classList.remove('active');
        });
      }
      
      if (modal) {
        modal.addEventListener('click', (e) => {
          if (e.target === modal) {
            modal.classList.remove('active');
          }
        });
      }
      
      // Listen for auth state changes
      onAuthStateChanged(auth, (user) => {
        if (user) {
          currentUserId = user.uid;
          listenToJoePayTransactions();
        } else {
          currentUserId = null;
          allTransactions = [];
          if (unsubscribeJoePay) {
            unsubscribeJoePay();
            unsubscribeJoePay = null;
          }
          updateNotificationBadge();
        }
      });
    }
    
    // Initialize when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', setupJoePayNotifications);
    } else {
      setupJoePayNotifications();
    }
  </script>
  <script>
    // The Great Reset Countdown - January 29, 2026
    function updateResetCountdown() {
      const resetDate = new Date('2026-01-29T00:00:00').getTime();
      const now = new Date().getTime();
      const distance = resetDate - now;
      
      if (distance < 0) {
        document.getElementById('resetCountdownBanner').innerHTML = '<div class="reset-countdown-content"><div class="reset-icon">üéâ</div><div class="reset-info"><h3 class="reset-title">THE GREAT RESET IS HERE!</h3><p class="reset-desc">Welcome to the official launch of Mulon!</p></div></div>';
        return;
      }
      
      const days = Math.floor(distance / (1000 * 60 * 60 * 24));
      const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const mins = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
      const secs = Math.floor((distance % (1000 * 60)) / 1000);
      
      document.getElementById('resetDays').textContent = days.toString().padStart(2, '0');
      document.getElementById('resetHours').textContent = hours.toString().padStart(2, '0');
      document.getElementById('resetMins').textContent = mins.toString().padStart(2, '0');
      document.getElementById('resetSecs').textContent = secs.toString().padStart(2, '0');
    }
    
    updateResetCountdown();
    setInterval(updateResetCountdown, 1000);
  </script>
</body>
</html>