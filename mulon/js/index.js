import{MulonData as e,OrderBook as t,Auth as n,UserData as a,OnboardingState as s,OverUnderSync as i}from"./data.js";import{checkMaintenanceAccess as o,MAINTENANCE_MODE as c}from"./maintenance.js";localStorage.setItem("lol","nice try, but i learnt from last time.");let d=null;function l(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function r(e){const t=parseFloat(e)||0,[n,a]=t.toFixed(2).split(".");return`$${l(n)}.${a}`}window.FormatUtils={formatWithCommas:l,formatBalance:r,formatCurrency:function(e){const t=parseFloat(e)||0,n=Math.abs(t),[a,s]=n.toFixed(2).split("."),i=l(a)+"."+s;return t>=0?`+$${i}`:`-$${i}`},formatProfit:function(e){const t=parseFloat(e)||0,[n,a]=Math.abs(t).toFixed(2).split(".");return(t>=0?"+":"-")+"$"+(l(n)+"."+a)}},document.addEventListener("DOMContentLoaded",(async function(){if(n.init(),"function"==typeof window.checkBanStatus){if(await window.checkBanStatus())return}if(c){if(!await o({getUser:()=>n.getUser(),redirectUrl:"maintenance.html"}))return}s.hasCompletedOnboarding()?u():function(){const e=document.getElementById("onboardingOverlay");e&&(e.classList.remove("hidden"),setTimeout((()=>{0===m&&g(1)}),2e3))}(),function(){const e=document.getElementById("googleSignInBtn");e&&e.addEventListener("click",(async()=>{const e=await n.signInWithGoogle();if(e.success){!function(){const e=document.getElementById("betaModal");if(e){e.classList.add("active");const t=document.getElementById("dismissBetaBtn");t&&(t.onclick=()=>{e.classList.remove("active")}),e.onclick=t=>{t.target===e&&e.classList.remove("active")}}}();const t=e.user?.email;if(t){const n=await i.checkForOverUnderAccount(t);if(n.found&&n.username)return void function(e,t){const n=document.getElementById("ouSyncModal"),a=document.getElementById("ouSyncUsername");n&&a&&(a.textContent=e.username,d={mulonUserId:t,username:e.username,name:e.name},n.classList.add("active"))}(n,e.user.uid)}g(2)}else ae("Sign in failed. Please try again.","error")}));const t=document.getElementById("skipSignInBtn");t&&t.addEventListener("click",(()=>{n.setGuestMode(),g(2)}));!function(){const e=document.getElementById("ouSyncYes"),t=document.getElementById("ouSyncNo");e&&e.addEventListener("click",(async()=>{if(d){(await i.syncUsername(d.mulonUserId,d.username)).success&&ae(`Welcome back, ${d.username}!`,"success")}$(),g(2)}));t&&t.addEventListener("click",(()=>{$(),g(2)}))}();document.querySelectorAll(".next-btn").forEach((e=>{e.addEventListener("click",(()=>{g(parseInt(e.dataset.next))}))}));const a=document.getElementById("startTradingBtn");a&&a.addEventListener("click",(()=>{s.setCompleted(),u()}));document.querySelectorAll(".progress-dot").forEach((e=>{e.addEventListener("click",(()=>{const t=parseInt(e.dataset.segment);(t<=m||t===m+1)&&g(t)}))}))}(),function(){const e=document.getElementById("userMenu"),t=document.getElementById("userAvatar");t&&e&&(t.addEventListener("click",(t=>{t.stopPropagation(),e.classList.toggle("open")})),document.addEventListener("click",(()=>{e.classList.remove("open")})));const s=document.getElementById("headerSignInBtn");s&&s.addEventListener("click",(async()=>{(await n.signInWithGoogle()).success&&ae("Signed in successfully!","success")}));const i=document.getElementById("signOutBtn");i&&i.addEventListener("click",(async()=>{await n.signOut(),ae("Signed out","success")}));const o=document.getElementById("modalSignInBtn");o&&o.addEventListener("click",(async()=>{(await n.signInWithGoogle()).success&&(p(),ae("Signed in! You can now trade.","success"))}));const c=document.getElementById("cancelSignInBtn");c&&c.addEventListener("click",p);!function(){const e=document.getElementById("editProfileBtn"),t=document.getElementById("profileModal"),s=document.getElementById("closeProfileModal"),i=document.getElementById("cancelProfileBtn"),o=document.getElementById("saveProfileBtn"),c=document.querySelectorAll(".avatar-option"),d=document.getElementById("profileUsername");e&&e.addEventListener("click",(()=>{!function(){const e=document.getElementById("profileModal"),t=document.getElementById("profileUsername"),n=document.querySelectorAll(".avatar-option");if(!e)return;const s=a.getDisplayName(),i=a.getAvatarStyle();t&&(t.value=s||"");h=i||"default",n.forEach((e=>{e.classList.toggle("selected",e.dataset.avatar===h)})),b(),e.classList.add("active")}()}));s&&s.addEventListener("click",E);i&&i.addEventListener("click",E);t&&t.addEventListener("click",(e=>{e.target===t&&E()}));c.forEach((e=>{e.addEventListener("click",(()=>{c.forEach((e=>e.classList.remove("selected"))),e.classList.add("selected"),h=e.dataset.avatar,b()}))})),d&&d.addEventListener("input",b);o&&o.addEventListener("click",(async()=>{const e=d.value.trim();if(0===e.length)return void ae("Please enter a display name","error");if(e.length>20)return void ae("Display name must be 20 characters or less","error");o.disabled=!0,o.textContent="Saving...";(await a.updateProfile(e,h)).success?(ae("Profile updated!","success"),E(),y(n.getUser())):ae("Failed to update profile","error"),o.disabled=!1,o.textContent="Save Changes"}))}()}(),function(){const e=document.getElementById("featuredContainer"),t=document.getElementById("marketGrid");e&&(e.innerHTML='<div class="loading">Loading markets...</div>');t&&(t.innerHTML="")}(),await e.init(),function(){const t=document.getElementById("navCategories");if(!t)return;const n=e.getCategories(),a=k();(function(e){let t=document.getElementById("dynamicCategoryStyles");t||(t=document.createElement("style"),t.id="dynamicCategoryStyles",document.head.appendChild(t));const n=[{bg:"rgba(99, 102, 241, 0.1)",color:"#6366f1"},{bg:"rgba(245, 158, 11, 0.1)",color:"#f59e0b"},{bg:"rgba(139, 92, 246, 0.1)",color:"#8b5cf6"},{bg:"rgba(16, 185, 129, 0.1)",color:"#10b981"},{bg:"rgba(236, 72, 153, 0.1)",color:"#ec4899"},{bg:"rgba(14, 165, 233, 0.1)",color:"#0ea5e9"},{bg:"rgba(249, 115, 22, 0.1)",color:"#f97316"},{bg:"rgba(34, 197, 94, 0.1)",color:"#22c55e"}];let a="",s=0;Object.entries(e).forEach((([e,t])=>{const i=n[s%n.length];a+=`\n      .category-tag.${e} { background: ${i.bg}; color: ${i.color}; }\n      .cat-pill.${e} { background: ${i.bg}; color: ${i.color}; }\n      .cat-pill.${e}:hover { background: ${i.bg.replace("0.1","0.2")}; }\n    `,s++})),t.textContent=a})(n),t.innerHTML=Object.entries(n).map((([e,t])=>`\n    <li><a href="index.html?cat=${e}" class="cat-pill ${e} ${a===e?"active":""}">${t.icon} ${t.label}</a></li>\n  `)).join(""),function(){const e=k(),t=window.location.pathname;document.querySelectorAll(".nav-links .nav-link").forEach((n=>{n.classList.remove("active");const a=n.getAttribute("href");t.includes("leaderbaord")&&a.includes("leaderbaord")?n.classList.add("active"):e||t.includes("leaderbaord")||"index.html"!==a?"all"===e&&"index.html?cat=all"===a&&n.classList.add("active"):n.classList.add("active")}))}()}(),F(),function(){B=document.getElementById("betModal"),w=document.getElementById("closeModal"),I=document.getElementById("modalTitle"),x=document.getElementById("modalChoice"),L=document.getElementById("yesPrice"),C=document.getElementById("noPrice"),S=document.getElementById("priceYes"),M=document.getElementById("priceNo"),P=document.getElementById("amountInput"),T=document.getElementById("oddsValue"),U=document.getElementById("payoutValue"),q=document.getElementById("buyBtn"),A=document.querySelectorAll(".modal-tab"),w&&w.addEventListener("click",K);B&&B.addEventListener("click",(function(e){e.target===B&&K()}));document.addEventListener("keydown",(function(e){"Escape"===e.key&&B&&B.classList.contains("active")&&K()})),S&&S.addEventListener("click",(function(){j="yes",V(),z()}));M&&M.addEventListener("click",(function(){j="no",V(),z()}));P&&P.addEventListener("input",z);A.forEach((e=>{e.addEventListener("click",(function(){A.forEach((e=>e.classList.remove("active"))),this.classList.add("active"),z()}))})),q&&q.addEventListener("click",(async function(){if(!n.isSignedIn())return void function(){const e=document.getElementById("signinRequiredModal");e&&e.classList.add("active")}();const s=parseFloat(P.value)||0;if(s<=0)return void ae("Please enter a valid amount","error");if(s<.1)return void ae("Minimum order is $0.10","error");if(s>a.getBalance())return void ae("Insufficient balance!","error");const i=e.getMarket(Y);if(i){q.disabled=!0,q.textContent="Processing...";try{const e=n.getUser()?.uid||"anonymous",o=await t.executeMarketOrder(Y,"buy",j,s,e);if(!o.filled)return void ae(o.error||"Order could not be filled","error");await a.updateBalance(-s),await a.addPosition(Y,i.title,j,o.shares,s,o.avgPrice);const c=0!==o.priceChange?` (${o.priceChange>0?"+":""}${o.priceChange}¬¢)`:"";ae(`Bought ${o.shares} ${j.toUpperCase()} @ ${o.avgPrice}¬¢${c} ‚Üí Now ${o.newPrice}¬¢`,"success"),X(),F(),K()}catch(e){console.error("Order execution error:",e),ae("Order failed. Please try again.","error")}finally{q.disabled=!1,q.textContent="Buy"}}else ae("Market not found","error")}))}(),function(){const e=document.getElementById("sidebar"),t=document.getElementById("sidebarToggle"),n=document.getElementById("sidebarOverlay"),a=document.querySelectorAll(".sidebar-tab");t&&t.addEventListener("click",(()=>{e.classList.toggle("open"),n.classList.toggle("active"),document.body.classList.toggle("sidebar-open")}));n&&n.addEventListener("click",(()=>{e.classList.remove("open"),n.classList.remove("active"),document.body.classList.remove("sidebar-open")}));a.forEach((e=>{e.addEventListener("click",(()=>{a.forEach((e=>e.classList.remove("active"))),e.classList.add("active");const t=e.dataset.tab;document.querySelectorAll(".sidebar-panel").forEach((e=>{e.classList.remove("active")})),document.getElementById(t+"Panel").classList.add("active")}))}))}(),function(){const t=document.getElementById("suggestBtn"),a=document.getElementById("suggestModal"),s=document.getElementById("closeSuggestModal"),i=document.getElementById("suggestForm"),o=document.getElementById("suggestCategory");if(o){const t=e.getCategories();Object.entries(t).forEach((([e,t])=>{const n=document.createElement("option");n.value=e,n.textContent=`${t.icon} ${t.label}`,o.appendChild(n)}))}t&&t.addEventListener("click",(()=>{a&&(a.classList.add("active"),document.body.style.overflow="hidden")}));s&&s.addEventListener("click",_);a&&a.addEventListener("click",(e=>{e.target===a&&_()}));i&&i.addEventListener("submit",(async t=>{if(t.preventDefault(),"function"==typeof window.checkBanStatus){if(await window.checkBanStatus())return}const a=document.getElementById("suggestTitle").value.trim(),s=document.getElementById("suggestCategory").value,o=document.getElementById("suggestReason").value.trim();if(!a)return void ae("Please enter a market question","error");const c=n.currentUser,d=c?c.uid:null,l=c?c.email:null,r=c?c.displayName:null,m=await e.submitSuggestion(a,s,o,d,l,r);m.success?(ae("Thanks! Your suggestion has been submitted.","success"),i.reset(),_()):ae(m.error||"Error submitting suggestion. Please try again.","error")}))}(),function(){const e=document.getElementById("keysInfoBtn"),t=document.getElementById("keysTooltip");e&&t&&(e.addEventListener("click",(e=>{e.stopPropagation(),t.classList.toggle("active")})),document.addEventListener("click",(()=>{t.classList.remove("active")})))}(),function(){const e=document.getElementById("claimDailyKeyBtn");e&&e.addEventListener("click",(async()=>{if(!n.getUser())return void document.getElementById("signinRequiredModal").classList.add("active");const t=await a.claimDailyKey();t.success&&(J(),Z(),ee(),ae(`üî• Day ${t.streak} Streak! +${t.keysReward} Keys & +$${t.balanceReward} (${t.multiplier}x)`,"success"),e.classList.add("claimed"),e.querySelector(".claim-text").textContent="Claimed!",setTimeout((()=>{e.classList.remove("claimed")}),1e3))}))}(),n.onAuthStateChange((async e=>{if("function"==typeof window.checkBanStatus){if(await window.checkBanStatus())return}y(e),X(),ee(),e&&setTimeout((()=>{!function(){const e=a.getUnseenWins();e.length>0&&function(e){const t=document.getElementById("winCelebrationOverlay"),n=document.getElementById("winModalBody"),s=document.getElementById("winModalOkBtn"),i=document.getElementById("confettiContainer");if(!t||!n)return;(function(e){if(!e)return;const t=["#00c853","#ffd700","#ff4757","#3b82f6","#8b5cf6","#f59e0b","#ec4899"],n=["square","circle"];for(let a=0;a<150;a++){const a=document.createElement("div");a.className="confetti";const s=t[Math.floor(Math.random()*t.length)],i=n[Math.floor(Math.random()*n.length)],o=100*Math.random(),c=2*Math.random(),d=8*Math.random()+6,l=2*Math.random()+2;a.style.cssText=`\n      left: ${o}%;\n      width: ${d}px;\n      height: ${d}px;\n      background: ${s};\n      border-radius: ${"circle"===i?"50%":"2px"};\n      animation-delay: ${c}s;\n      animation-duration: ${l}s;\n    `,e.appendChild(a)}})(i),n.innerHTML=e.map((e=>`\n      <div class="win-item">\n        <div class="win-item-icon">üéâ</div>\n        <div class="win-item-details">\n          <div class="win-item-market">${e.marketTitle||"Market"}</div>\n          <div class="win-item-info">${e.shares} ${e.position.toUpperCase()} shares</div>\n        </div>\n        <div class="win-item-payout">+$${e.payout.toFixed(2)}</div>\n      </div>\n    `)).join("");const o=e.reduce(((e,t)=>e+t.payout),0);e.length>1&&(n.innerHTML+=`\n      <div class="win-item" style="background: linear-gradient(135deg, rgba(0, 200, 83, 0.1), rgba(0, 200, 83, 0.05)); border-left-color: gold;">\n        <div class="win-item-icon">üí∞</div>\n        <div class="win-item-details">\n          <div class="win-item-market">Total Winnings</div>\n          <div class="win-item-info">${e.length} winning positions</div>\n        </div>\n        <div class="win-item-payout" style="color: gold;">+$${o.toFixed(2)}</div>\n      </div>\n    `);t.classList.add("active"),s.onclick=async()=>{const n=e.map((e=>e.marketId+"_"+e.timestamp));await a.markCashoutsAsSeen(n),t.classList.remove("active"),i.innerHTML=""}}(e)}(),setTimeout((()=>{!function(){const e=function(){const e=localStorage.getItem(f)||"0.0.0";return v.filter((t=>function(e,t){const n=e.split(".").map(Number),a=t.split(".").map(Number);for(let e=0;e<Math.max(n.length,a.length);e++){const t=n[e]||0,s=a[e]||0;if(t>s)return 1;if(t<s)return-1}return 0}(t.version,e)>0))}();e.length>0&&function(e){let t=document.getElementById("updateModal");if(!t&&(t=document.createElement("div"),t.id="updateModal",t.className="modal-overlay",t.innerHTML='\n      <div class="modal update-modal">\n        <div class="modal-header">\n          <h2>üéâ What\'s New</h2>\n          <button class="modal-close" id="closeUpdateModal">&times;</button>\n        </div>\n        <div class="modal-body" id="updateModalBody">\n        </div>\n        <div class="modal-footer">\n          <button class="btn btn-primary" id="dismissUpdateBtn">Got it!</button>\n        </div>\n      </div>\n    ',document.body.appendChild(t),!document.getElementById("updateModalStyles"))){const e=document.createElement("style");e.id="updateModalStyles",e.textContent="\n        .update-modal {\n          max-width: 420px;\n          width: 90%;\n        }\n        .update-modal .modal-body {\n          padding: 1.5rem;\n          max-height: 400px;\n          overflow-y: auto;\n        }\n        .update-version {\n          margin-bottom: 1.25rem;\n        }\n        .update-version:last-child {\n          margin-bottom: 0;\n        }\n        .update-version-header {\n          display: flex;\n          align-items: center;\n          gap: 0.75rem;\n          margin-bottom: 0.75rem;\n        }\n        .update-version-tag {\n          background: var(--green-primary);\n          color: white;\n          padding: 0.25rem 0.6rem;\n          border-radius: var(--radius-full);\n          font-size: 0.75rem;\n          font-weight: 600;\n        }\n        .update-version-date {\n          color: var(--text-muted);\n          font-size: 0.8rem;\n        }\n        .update-changes {\n          list-style: none;\n          padding: 0;\n          margin: 0;\n        }\n        .update-changes li {\n          display: flex;\n          align-items: flex-start;\n          gap: 0.5rem;\n          padding: 0.4rem 0;\n          color: var(--text-primary);\n          font-size: 0.9rem;\n        }\n        .update-changes li::before {\n          content: '‚ú®';\n          flex-shrink: 0;\n        }\n      ",document.head.appendChild(e)}document.getElementById("updateModalBody").innerHTML=e.map((e=>`\n    <div class="update-version">\n      <div class="update-version-header">\n        <span class="update-version-tag">v${e.version}</span>\n        <span class="update-version-date">${e.date}</span>\n      </div>\n      <ul class="update-changes">\n        ${e.changes.map((e=>`<li>${e}</li>`)).join("")}\n      </ul>\n    </div>\n  `)).join(""),t.classList.add("active");const n=document.getElementById("dismissUpdateBtn"),a=document.getElementById("closeUpdateModal"),s=()=>{t.classList.remove("active");const n=e[0].version;var a;a=n,localStorage.setItem(f,a)};n.onclick=s,a.onclick=s,t.onclick=e=>{e.target===t&&s()}}(e)}()}),500)}),500)}))}));let m=0;function u(){const e=document.getElementById("onboardingOverlay");e&&e.classList.add("hidden")}function g(e){const t=document.querySelectorAll(".onboarding-segment"),n=document.querySelectorAll(".progress-dot"),a=document.getElementById("onboardingProgress");t.forEach((t=>{const n=parseInt(t.dataset.segment);n===m?(t.classList.add("exit"),t.classList.remove("active")):n===e?setTimeout((()=>{t.classList.add("active"),t.classList.remove("exit")}),100):t.classList.remove("active","exit")})),a&&(a.style.opacity=0===e?"0":"1"),n.forEach((t=>{const n=parseInt(t.dataset.segment);t.classList.toggle("active",n===e),t.classList.toggle("completed",n<e&&n>=1)})),m=e}function y(e){const t=document.getElementById("userInitials"),n=document.getElementById("userPhoto"),s=document.getElementById("userName"),i=document.getElementById("userEmail"),o=document.getElementById("signOutBtn"),c=document.getElementById("headerSignInBtn"),d=document.getElementById("editProfileBtn"),l=document.getElementById("userAvatar");if(e&&!e.isGuest){const r=a.getAvatarStyle(),m=a.getDisplayName();if("default"===r&&e.photoURL)n&&(n.src=e.photoURL,n.style.display="block"),t&&(t.style.display="none"),l&&(l.style.background="");else if(r&&r.startsWith("gradient")){if(n&&(n.style.display="none"),t){const e=m?m.split(" ").map((e=>e[0])).join("").toUpperCase().slice(0,2):"?";t.textContent=e,t.style.display="flex"}const e={gradient1:"linear-gradient(135deg, #667eea, #764ba2)",gradient2:"linear-gradient(135deg, #11998e, #38ef7d)",gradient3:"linear-gradient(135deg, #fc4a1a, #f7b733)",gradient4:"linear-gradient(135deg, #141e30, #243b55)",gradient5:"linear-gradient(135deg, #ff9a9e, #fecfef)",gradient6:"linear-gradient(135deg, #00c853, #00e676)",gradient7:"linear-gradient(135deg, #232526, #414345)"};l&&(l.style.background=e[r]||"")}else{if(n&&e.photoURL)n.src=e.photoURL,n.style.display="block",t&&(t.style.display="none");else if(t){const e=m?m.split(" ").map((e=>e[0])).join("").toUpperCase().slice(0,2):"?";t.textContent=e,t.style.display="flex",n&&(n.style.display="none")}l&&(l.style.background="")}s&&(s.textContent=m||"User"),i&&(i.textContent=e.email||""),o&&(o.style.display="flex"),d&&(d.style.display="flex"),c&&(c.style.display="none")}else t&&(t.textContent=e?.isGuest?"G":"?",t.style.display="flex"),n&&(n.style.display="none"),l&&(l.style.background=""),s&&(s.textContent=e?.isGuest?"Guest":"Not signed in"),i&&(i.textContent=e?.isGuest?"Browsing only":"Sign in to trade"),o&&(o.style.display="none"),d&&(d.style.display="none"),c&&(c.style.display="flex")}function p(){const e=document.getElementById("signinRequiredModal");e&&e.classList.remove("active")}const v=[{version:"1.0.6",date:"2026-01-26",changes:["wheel game is now out"]}],f="mulon_last_seen_update";let h="default";function E(){const e=document.getElementById("profileModal");e&&e.classList.remove("active")}function b(){const e=document.getElementById("profilePreviewInitials"),t=document.getElementById("profilePreviewPhoto"),s=document.getElementById("profileAvatarPreview"),i=document.getElementById("profileUsername"),o=n.getUser(),c=i?.value||a.getDisplayName()||"User",d=c?c.split(" ").map((e=>e[0])).join("").toUpperCase().slice(0,2):"?",l={gradient1:"linear-gradient(135deg, #667eea, #764ba2)",gradient2:"linear-gradient(135deg, #11998e, #38ef7d)",gradient3:"linear-gradient(135deg, #fc4a1a, #f7b733)",gradient4:"linear-gradient(135deg, #141e30, #243b55)",gradient5:"linear-gradient(135deg, #ff9a9e, #fecfef)",gradient6:"linear-gradient(135deg, #00c853, #00e676)",gradient7:"linear-gradient(135deg, #232526, #414345)"};"default"===h&&o?.photoURL?(t&&(t.src=o.photoURL,t.style.display="block"),e&&(e.style.display="none"),s&&(s.style.background="")):h.startsWith("gradient")?(t&&(t.style.display="none"),e&&(e.textContent=d,e.style.display="flex"),s&&(s.style.background=l[h]||"")):(t&&(t.style.display="none"),e&&(e.textContent=d,e.style.display="flex"),s&&(s.style.background=""))}function $(){const e=document.getElementById("ouSyncModal");e&&e.classList.remove("active"),d=null}function k(){return new URLSearchParams(window.location.search).get("cat")||null}let B,w,I,x,L,C,S,M,P,T,U,q,A,D=0,N=[];function F(){const n=k();let s=e.getActiveMarkets();const i=n&&"all"!==n;i&&(s=s.filter((e=>e.category===n))),function(t){const n=document.querySelector(".section-title"),a=document.querySelectorAll(".section-title")[1];if(t&&"all"!==t){const n=e.getCategory(t);a&&(a.textContent=`${n.icon} ${n.label} Markets`)}else"all"===t?(n&&(n.textContent="üìä Featured Markets"),a&&(a.textContent="All Markets")):(n&&(n.textContent="üî• Trending Markets"),a&&(a.textContent="üìä All Markets"))}(n);const o=document.querySelector(".section:first-of-type"),c=document.getElementById("featuredContainer"),d=document.getElementById("marketGrid");if(i||"all"===n)o&&(o.style.display="none"),d&&(s.length>0?d.innerHTML=s.map((e=>H(e))).join(""):d.innerHTML='<div class="empty-state">No markets in this category.</div>');else{o&&(o.style.display="block");const n=s.filter((e=>e.featured)),i=s.filter((e=>!e.featured));if(N=n.length>0?n:s.length>0?[s[0]]:[],c&&(N.length>0?(c.innerHTML=function(t){const n=t.map(((t,n)=>function(t,n){const s=e.getCategory(t.category),i=new Date,o=new Date(`${t.endDate}T${t.endTime||"23:59"}`),c=i>o,d=!0===t.resolved,l=c&&!d,r=a.getPositions().find((e=>e.marketId===t.id)),m=!!r,u=!d&&!l&&!m;let g="";if(d){const e="yes"===t.resolvedOutcome?"‚úì YES Won":"‚úó NO Won";g=`<span class="market-result ${t.resolvedOutcome}">${e}</span>`}else l&&(g='<span class="market-result pending">‚è≥ Awaiting Result</span>');return`\n    <div class="featured-slide ${0===n?"active":""}" data-slide-index="${n}">\n      <div class="featured-card ${d?"resolved":""} ${l?"pending":""}" data-market-id="${t.id}">\n        <div class="featured-card-main">\n          <div class="featured-card-info">\n            <div class="card-header">\n              <div class="card-category">\n                <span class="category-tag ${t.category}">${s.icon} ${s.label}</span>\n                <span class="volume">${e.formatVolume(t.volume)}</span>\n              </div>\n              <div class="card-time">\n                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                  <circle cx="12" cy="12" r="10"></circle>\n                  <polyline points="12 6 12 12 16 14"></polyline>\n                </svg>\n                <span>${e.getDaysUntil(t.endDate)}${t.endTime?" @ "+t.endTime:""}</span>\n              </div>\n            </div>\n            <h3 class="card-title">${t.title}</h3>\n            <p class="card-subtitle">${t.subtitle||""}</p>\n            ${g}\n            \n            <div class="probability-bar">\n              <div class="prob-fill" style="width: ${t.yesPrice}%;"></div>\n            </div>\n            <div class="prob-labels">\n              <span class="prob-yes">${t.yesPrice}% Yes</span>\n              <span class="prob-no">${t.noPrice}% No</span>\n            </div>\n          </div>\n          \n          <div class="featured-card-graph" data-market-id="${t.id}">\n            <div class="graph-header">\n              <span class="graph-price">${t.yesPrice}%</span>\n              <span class="graph-label">probability</span>\n            </div>\n            <div class="graph-container">\n              <svg class="price-graph" data-market-id="${t.id}" viewBox="0 0 200 80" preserveAspectRatio="none">\n                <defs>\n                  <linearGradient id="graphGradient-${t.id}" x1="0%" y1="0%" x2="0%" y2="100%">\n                    <stop offset="0%" stop-color="var(--green-primary)" stop-opacity="0.3"/>\n                    <stop offset="100%" stop-color="var(--green-primary)" stop-opacity="0.02"/>\n                  </linearGradient>\n                </defs>\n                <path class="graph-area" fill="url(#graphGradient-${t.id})" d=""></path>\n                <path class="graph-line" fill="none" stroke="var(--green-primary)" stroke-width="2" d=""></path>\n              </svg>\n              <div class="graph-loading">Loading...</div>\n            </div>\n            <div class="graph-dates">\n              <span class="graph-date-start"></span>\n              <span class="graph-date-end">Now</span>\n            </div>\n          </div>\n        </div>\n\n        ${u?`\n          <div class="bet-buttons">\n            <button class="bet-btn yes" data-market-id="${t.id}" data-choice="yes">\n              <div class="bet-label">Yes</div>\n              <div class="bet-price">${t.yesPrice}¬¢</div>\n            </button>\n            <button class="bet-btn no" data-market-id="${t.id}" data-choice="no">\n              <div class="bet-label">No</div>\n              <div class="bet-price">${t.noPrice}¬¢</div>\n            </button>\n          </div>\n          <div class="payout-info">\n            <span class="payout yes-payout">$100 ‚Üí $${Math.round(100/(t.yesPrice/100))}</span>\n            <span class="payout no-payout">$100 ‚Üí $${Math.round(100/(t.noPrice/100))}</span>\n          </div>\n        `:m?`\n          <div class="user-position-display ${r.choice}">\n            <div class="position-badge ${r.choice}">\n              <span class="position-icon">${"yes"===r.choice?"‚úì":"‚úó"}</span>\n              <span class="position-label">You picked ${r.choice.toUpperCase()}</span>\n            </div>\n            <div class="position-details">\n              <span>${r.shares} shares @ ${r.avgPrice}¬¢</span>\n            </div>\n          </div>\n        `:`\n          <div class="market-closed-notice">\n            ${d?"Market Resolved":"Betting Closed"}\n          </div>\n        `}\n      </div>\n    </div>\n  `}(t,n))).join(""),s=t.length>1?`\n    <div class="slider-dots">\n      ${t.map(((e,t)=>`<button class="slider-dot ${0===t?"active":""}" data-slide="${t}"></button>`)).join("")}\n    </div>\n  `:"";return`\n    <div class="featured-slider">\n      ${t.length>1?'\n        <button class="slider-arrow slider-prev" aria-label="Previous">\n          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n            <polyline points="15 18 9 12 15 6"></polyline>\n          </svg>\n        </button>\n      ':""}\n      <div class="slider-track">\n        ${n}\n      </div>\n      ${t.length>1?'\n        <button class="slider-arrow slider-next" aria-label="Next">\n          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n            <polyline points="9 18 15 12 9 6"></polyline>\n          </svg>\n        </button>\n      ':""}\n      ${s}\n    </div>\n  `}(N),function(){const e=document.querySelector(".slider-prev"),t=document.querySelector(".slider-next"),n=document.querySelectorAll(".slider-dot");e&&e.addEventListener("click",(()=>R(D-1)));t&&t.addEventListener("click",(()=>R(D+1)));n.forEach((e=>{e.addEventListener("click",(()=>{R(parseInt(e.dataset.slide))}))}));const a=document.querySelector(".slider-track");if(a){let e=0,t=!1;a.addEventListener("touchstart",(n=>{e=n.touches[0].clientX,t=!0})),a.addEventListener("touchend",(n=>{if(!t)return;const a=n.changedTouches[0].clientX,s=e-a;Math.abs(s)>50&&R(s>0?D+1:D-1),t=!1}))}}(),window.innerWidth>=900&&async function(){const n=document.querySelectorAll(".featured-card-graph");for(const a of n){const n=a.dataset.marketId;if(n)try{const s=await t.getRecentTrades(n,0);O(a,s,e.getMarket(n))}catch(e){console.warn("Error loading price graph for market",n,e),a.querySelector(".graph-loading").textContent="No data"}}}()):c.innerHTML='<div class="empty-state">No markets available yet.</div>'),d){const e=n.length>0?i:s.slice(1);e.length>0?d.innerHTML=e.map((e=>H(e))).join(""):d.innerHTML=""}}!function(){document.querySelectorAll(".bet-btn").forEach((t=>{t.addEventListener("click",(function(t){t.stopPropagation();const n=this.dataset.marketId,a=this.dataset.choice,s=e.getMarket(n);if(!s)return;Y=n,W=s.yesPrice,G=s.noPrice,j=a;const i=e.getCategory(s.category);I&&(I.textContent=s.title),document.querySelector(".modal-market-icon").textContent=i.icon,L&&(L.textContent=s.yesPrice+"¬¢"),C&&(C.textContent=s.noPrice+"¬¢"),V(),z(),B&&(B.classList.add("active"),document.body.style.overflow="hidden")}))}));document.querySelectorAll(".market-card").forEach((e=>{e.addEventListener("click",(function(e){if(e.target.closest(".bet-btn"))return;const t=this.querySelector(".bet-btn.yes");t&&t.click()}))}))}()}function O(e,t,n){const a=e.querySelector(".price-graph"),s=e.querySelector(".graph-loading"),i=e.querySelector(".graph-date-start"),o=a.querySelector(".graph-line"),c=a.querySelector(".graph-area");if(!a||!n)return;let d=[];const l=n.createdAt?new Date(n.createdAt):new Date(Date.now()-6048e5);if(d.push({timestamp:l,price:50}),t.length>0){[...t].sort(((e,t)=>new Date(e.timestamp)-new Date(t.timestamp))).forEach((e=>{let t;t=void 0!==e.priceAfter?"yes"===e.choice?e.priceAfter:100-e.priceAfter:"yes"===e.choice?e.price:100-e.price,d.push({timestamp:new Date(e.timestamp),price:t})}))}if(d.push({timestamp:new Date,price:n.yesPrice}),d.length>0&&i){const e=d[0].timestamp;i.textContent=e.toLocaleDateString("en-US",{month:"short",day:"numeric"})}const r=d[0].timestamp.getTime(),m=d[d.length-1].timestamp.getTime()-r||1,u=d.map((e=>({x:2+(e.timestamp.getTime()-r)/m*196,y:78-(e.price-0)/100*76})));let g="",y="";if(u.length>1){g=`M ${u[0].x} ${u[0].y}`;for(let e=1;e<u.length;e++)g+=` L ${u[e].x} ${u[e].y}`;y=g+` L ${u[u.length-1].x} 80 L ${u[0].x} 80 Z`}o.setAttribute("d",g),c.setAttribute("d",y),s&&(s.style.display="none")}function R(e){const t=document.querySelectorAll(".featured-slide"),n=document.querySelectorAll(".slider-dot");0!==t.length&&(e<0&&(e=t.length-1),e>=t.length&&(e=0),D=e,t.forEach(((t,n)=>{t.classList.toggle("active",n===e)})),n.forEach(((t,n)=>{t.classList.toggle("active",n===e)})))}function H(t){const n=e.getCategory(t.category),s=new Date>new Date(`${t.endDate}T${t.endTime||"23:59"}`),i=!0===t.resolved,o=s&&!i,c=a.getPositions().find((e=>e.marketId===t.id)),d=!!c,l=!i&&!o&&!d;let r="";if(i){const e="yes"===t.resolvedOutcome?"‚úì YES":"‚úó NO";r=`<span class="card-status resolved ${t.resolvedOutcome}">${e}</span>`}else o&&(r='<span class="card-status pending">‚è≥ Pending</span>');return`\n    <div class="market-card ${i?"resolved":""} ${o?"pending":""}" data-market-id="${t.id}">\n      <div class="card-category">\n        <span class="category-tag ${t.category}">${n.icon} ${n.label}</span>\n        ${r}\n      </div>\n      <h4 class="card-title">${t.title}</h4>\n      ${t.subtitle?`<p class="card-description">${t.subtitle}</p>`:""}\n      <div class="card-meta">\n        <span class="card-volume">${e.formatVolume(t.volume)}</span>\n        <span class="card-time-text">Ends ${e.formatDate(t.endDate)}${t.endTime?" @ "+t.endTime:""}</span>\n      </div>\n      <div class="probability-bar small">\n        <div class="prob-fill" style="width: ${t.yesPrice}%;"></div>\n      </div>\n      ${l?`\n        <div class="bet-buttons compact">\n          <button class="bet-btn yes compact" data-market-id="${t.id}" data-choice="yes">\n            <span>Yes</span>\n            <span class="price">${t.yesPrice}¬¢</span>\n          </button>\n          <button class="bet-btn no compact" data-market-id="${t.id}" data-choice="no">\n            <span>No</span>\n            <span class="price">${t.noPrice}¬¢</span>\n          </button>\n        </div>\n      `:d?`\n        <div class="user-position-compact ${c.choice}">\n          <span class="position-icon">${"yes"===c.choice?"‚úì":"‚úó"}</span>\n          <span>You picked ${c.choice.toUpperCase()}</span>\n        </div>\n      `:`\n        <div class="market-closed-compact">\n          ${i?"Resolved":"Closed"}\n        </div>\n      `}\n    </div>\n  `}let j="yes",W=69,G=31,Y=null;function K(){B&&(B.classList.remove("active"),document.body.style.overflow="")}function V(){"yes"===j?(S&&S.classList.add("active"),M&&M.classList.remove("active"),x&&(x.textContent="Yes",x.className="choice-yes"),T&&(T.textContent=W+"¬¢")):(M&&M.classList.add("active"),S&&S.classList.remove("active"),x&&(x.textContent="No",x.className="choice-no"),T&&(T.textContent=G+"¬¢"))}function z(){if(!P||!U)return;const t=parseFloat(P.value)||0,n="yes"===j?W:G,a=t/(n/100),s=Math.round(a),i=document.getElementById("sharesValue");i&&(i.textContent=a.toFixed(2)),T&&(T.textContent=n+"¬¢");const o=e.getMarket(Y),c=document.getElementById("priceAfterValue"),d=document.getElementById("priceImpactNotice");if(o&&c){const e=o.volume||1e3,a=Math.min(t/e,.15);let s;s=q&&q.classList.contains("sell-mode")?Math.max(1,Math.round(n-100*a)):Math.min(99,Math.round(n+100*a));const i=s-n;0!==i?(c.textContent=`${s}¬¢ (${i>0?"+":""}${i})`,c.style.color=i>0?"var(--green-primary)":"var(--red-primary)"):(c.textContent=n+"¬¢",c.style.color="var(--text-primary)"),d&&(Math.abs(i)>=5?(d.style.display="flex",d.classList.toggle("large-impact",Math.abs(i)>=10)):d.style.display="none")}U.textContent="$"+s,U.style.color="yes"===j?"var(--green-primary)":"var(--red-primary)"}function _(){const e=document.getElementById("suggestModal");e&&(e.classList.remove("active"),document.body.style.overflow="")}function X(){Z(),J(),function(){const t=a.getPositions(),n=document.getElementById("positionsList"),s=document.getElementById("emptyPortfolio"),i=document.getElementById("positionCount"),o=document.getElementById("portfolioValue"),c=document.getElementById("totalValue"),d=document.getElementById("totalPnl");i&&(i.textContent=t.length);let l=0,r=0;t.forEach((t=>{const n=e.getMarket(t.marketId);if(n){const e="yes"===t.choice?n.yesPrice:n.noPrice;l+=t.shares*e/100,r+=t.costBasis}}));const m=l-r,u=a.getBalance();o&&(o.textContent="$"+l.toFixed(2));c&&(c.textContent="$"+(u+l).toFixed(2));if(d){const e=m>=0?"+":"";d.textContent=e+"$"+m.toFixed(2),d.className="stat-value "+(m>=0?"pnl-positive":"pnl-negative")}if(0===t.length)return s&&(s.style.display="flex"),void(n&&(n.innerHTML=""));s&&(s.style.display="none");n&&(n.innerHTML=t.map((t=>{const n=e.getMarket(t.marketId),a=n?"yes"===t.choice?n.yesPrice:n.noPrice:t.avgPrice,s=t.shares*a/100,i=s-t.costBasis,o=(100*(s/t.costBasis-1)).toFixed(1),c=!0===n?.resolved;return`\n        <div class="position-item" data-market-id="${t.marketId}">\n          <div class="position-header">\n            <div class="position-market">${t.marketTitle}</div>\n            ${c?'<span class="position-resolved-badge">Resolved</span>':""}\n          </div>\n          <div class="position-details">\n            <div class="position-info">\n              <span class="position-badge ${t.choice}">${t.choice.toUpperCase()}</span>\n              <span class="position-shares">${t.shares.toFixed(2)} shares @ ${t.avgPrice}¬¢</span>\n            </div>\n            <div class="position-value">\n              <div class="position-current">$${s.toFixed(2)}</div>\n              <div class="position-pnl ${i>=0?"positive":"negative"}">\n                ${i>=0?"+":""}$${i.toFixed(2)} (${o}%)\n              </div>\n            </div>\n          </div>\n        </div>\n      `})).join(""))}(),ne(),function(){const t=a.getCashOuts(),n=document.getElementById("cashoutsList"),s=document.getElementById("emptyCashouts"),i=document.getElementById("totalWon"),o=document.getElementById("totalLost"),c=document.getElementById("cashoutCount");let d=0,l=0;t.forEach((e=>{e.won?d+=e.payout:l+=e.cost})),i&&(i.textContent="$"+d.toFixed(2));o&&(o.textContent="$"+l.toFixed(2));c&&(c.textContent=t.length);if(0===t.length)return s&&(s.style.display="flex"),void(n&&(n.innerHTML=""));s&&(s.style.display="none");if(n){const a=[...t].sort(((e,t)=>new Date(t.timestamp)-new Date(e.timestamp)));n.innerHTML=a.map((t=>{const n=e.getMarket(t.marketId),a=n?n.title:t.marketTitle||"Unknown Market",s=t.won?"WON":"LOST",i=t.won?"+$"+t.payout.toFixed(2):"-$"+t.cost.toFixed(2);return`\n        <div class="cashout-item">\n          <div class="cashout-icon ${t.won?"won":"lost"}">\n            ${t.won?"‚úì":"‚úó"}\n          </div>\n          <div class="cashout-details">\n            <div class="cashout-market">${a}</div>\n            <div class="cashout-position">${t.shares} ${t.position.toUpperCase()} shares @ ${t.avgPrice}¬¢</div>\n          </div>\n          <div class="cashout-amount">\n            <div class="cashout-payout ${t.won?"won":"lost"}">${i}</div>\n            <div class="cashout-result ${t.won?"won":"lost"}">${s}</div>\n          </div>\n        </div>\n      `})).join("")}}()}function Z(){const e=document.getElementById("userBalance"),t=a.getBalance();e&&(e.textContent=r(t)),P&&(P.max=t)}function J(){const e=document.getElementById("userKeys"),t=a.getKeys();e&&(e.innerHTML='<img src="/bp/EE/assets/ouths/key.png" alt="" class="key-icon"> '+t)}let Q=null;function ee(){const e=document.getElementById("dailyKeyBox"),t=document.getElementById("claimDailyKeyBtn"),s=document.getElementById("dailyKeyTimer"),i=(document.getElementById("timerValue"),document.getElementById("dailyKeyDesc")),o=document.getElementById("streakFlame"),c=document.getElementById("streakCount"),d=document.getElementById("previewKeys"),l=document.getElementById("previewBalance"),r=document.getElementById("rewardMultiplier"),m=document.getElementById("rewardPreview");if(!n.getUser())return void(e&&(e.style.display="none"));e&&(e.style.display="block");const u=a.canClaimDailyKey(),g=a.getStreakRewardInfo();c&&(c.textContent=g.currentStreak),o&&(g.currentStreak>=7?(o.textContent="üî•",o.style.fontSize="2rem"):g.currentStreak>=3?(o.textContent="üî•",o.style.fontSize="1.5rem"):(o.textContent="‚ú®",o.style.fontSize="1.2rem")),d&&(d.textContent=g.keysReward),l&&(l.textContent=g.balanceReward),r&&(r.textContent=g.multiplier+"x"),u?(t&&(t.style.display="flex",t.disabled=!1,t.querySelector(".claim-text").textContent="Claim Rewards"),s&&(s.style.display="none"),m&&(m.style.display="flex"),i&&(g.currentStreak>0?i.textContent=`Day ${g.nextStreak} reward ready!`:i.textContent="Start your streak!"),Q&&(clearInterval(Q),Q=null)):(t&&(t.style.display="none"),s&&(s.style.display="flex"),m&&(m.style.opacity="0.5"),i&&(i.textContent=`üî• ${g.currentStreak} day streak!`),te(),Q||(Q=setInterval(te,1e3)))}function te(){const e=document.getElementById("timerValue"),t=a.getTimeUntilNextClaim();if(t<=0)return void ee();const n=Math.floor(t/36e5),s=Math.floor(t%36e5/6e4),i=Math.floor(t%6e4/1e3);e&&(e.textContent=String(n).padStart(2,"0")+":"+String(s).padStart(2,"0")+":"+String(i).padStart(2,"0"))}function ne(){const t=a.getWatchlist(),n=document.getElementById("watchlistItems"),s=document.getElementById("emptyWatchlist");if(0===t.length)return s&&(s.style.display="flex"),void(n&&(n.innerHTML=""));s&&(s.style.display="none"),n&&(n.innerHTML=t.map((t=>{const n=e.getMarket(t);if(!n)return"";return`\n        <div class="watchlist-item" data-market-id="${t}">\n          <div class="watchlist-icon">${e.getCategory(n.category).icon}</div>\n          <div class="watchlist-info">\n            <div class="watchlist-title">${n.title}</div>\n            <div class="watchlist-price">\n              <span style="color: var(--green-primary)">Yes ${n.yesPrice}¬¢</span> ¬∑ \n              <span style="color: var(--red-primary)">No ${n.noPrice}¬¢</span>\n            </div>\n          </div>\n          <button class="watchlist-remove" data-market-id="${t}">\n            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n              <line x1="18" y1="6" x2="6" y2="18"></line>\n              <line x1="6" y1="6" x2="18" y2="18"></line>\n            </svg>\n          </button>\n        </div>\n      `})).join(""),n.querySelectorAll(".watchlist-remove").forEach((e=>{e.addEventListener("click",(async t=>{t.stopPropagation(),await a.removeFromWatchlist(e.dataset.marketId),ne()}))})),n.querySelectorAll(".watchlist-item").forEach((t=>{t.addEventListener("click",(()=>{const n=t.dataset.marketId,a=e.getMarket(n);if(a){Y=n,W=a.yesPrice,G=a.noPrice,j="yes";const t=e.getCategory(a.category);I&&(I.textContent=a.title),document.querySelector(".modal-market-icon").textContent=t.icon,L&&(L.textContent=a.yesPrice+"¬¢"),C&&(C.textContent=a.noPrice+"¬¢"),V(),z(),B&&(B.classList.add("active"),document.body.style.overflow="hidden")}}))})))}function ae(e,t="success"){const n=document.querySelector(".notification");n&&n.remove();const a=document.createElement("div");a.className=`notification ${t}`,a.innerHTML=`\n    <span>${e}</span>\n    <button class="notification-close">√ó</button>\n  `,document.body.appendChild(a),setTimeout((()=>a.classList.add("show")),10),a.querySelector(".notification-close").addEventListener("click",(()=>{a.classList.remove("show"),setTimeout((()=>a.remove()),300)})),setTimeout((()=>{a.classList.remove("show"),setTimeout((()=>a.remove()),300)}),4e3)}