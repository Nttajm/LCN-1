import{MulonData,OrderBook,Auth,UserData,OnboardingState,OverUnderSync}from"./data.js";import{checkMaintenanceAccess,MAINTENANCE_MODE}from"./maintenance.js";localStorage.setItem("lol","nice try, but i learnt from last time.");let pendingOUSyncData=null;function formatWithCommas(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function formatBalance(e){const t=parseFloat(e)||0,[n,a]=t.toFixed(2).split(".");return`$${formatWithCommas(n)}.${a}`}function formatCurrency(e){const t=parseFloat(e)||0,n=Math.abs(t),[a,o]=n.toFixed(2).split("."),i=formatWithCommas(a)+"."+o;return t>=0?`+$${i}`:`-$${i}`}function formatProfit(e){const t=parseFloat(e)||0,[n,a]=Math.abs(t).toFixed(2).split(".");return(t>=0?"+":"-")+"$"+(formatWithCommas(n)+"."+a)}window.FormatUtils={formatWithCommas:formatWithCommas,formatBalance:formatBalance,formatCurrency:formatCurrency,formatProfit:formatProfit},document.addEventListener("DOMContentLoaded",(async function(){if(Auth.init(),"function"==typeof window.checkBanStatus){if(await window.checkBanStatus())return}if(MAINTENANCE_MODE){if(!await checkMaintenanceAccess({getUser:()=>Auth.getUser(),redirectUrl:"maintenance.html"}))return}OnboardingState.hasCompletedOnboarding()?hideOnboarding():showOnboarding(),setupOnboarding(),setupAuthUI(),showLoading(),await MulonData.init(),renderNavCategories(),renderMarkets(),setupModal(),setupSidebar(),setupSuggestionModal(),setupKeysTooltip(),setupDailyKeyClaim(),Auth.onAuthStateChange((async e=>{if("function"==typeof window.checkBanStatus){if(await window.checkBanStatus())return}updateAuthUI(e),updateUserUI(),updateDailyKeyUI(),e&&setTimeout((()=>{checkForUnseenWins(),setTimeout((()=>{checkForUpdates()}),500)}),500)}))}));let currentSegment=0;function showOnboarding(){const e=document.getElementById("onboardingOverlay");e&&(e.classList.remove("hidden"),setTimeout((()=>{0===currentSegment&&goToSegment(1)}),2e3))}function hideOnboarding(){const e=document.getElementById("onboardingOverlay");e&&e.classList.add("hidden")}function goToSegment(e){const t=document.querySelectorAll(".onboarding-segment"),n=document.querySelectorAll(".progress-dot"),a=document.getElementById("onboardingProgress");t.forEach((t=>{const n=parseInt(t.dataset.segment);n===currentSegment?(t.classList.add("exit"),t.classList.remove("active")):n===e?setTimeout((()=>{t.classList.add("active"),t.classList.remove("exit")}),100):t.classList.remove("active","exit")})),a&&(a.style.opacity=0===e?"0":"1"),n.forEach((t=>{const n=parseInt(t.dataset.segment);t.classList.toggle("active",n===e),t.classList.toggle("completed",n<e&&n>=1)})),currentSegment=e}function setupOnboarding(){const e=document.getElementById("googleSignInBtn");e&&e.addEventListener("click",(async()=>{const e=await Auth.signInWithGoogle();if(e.success){showBetaModal();const t=e.user?.email;if(t){const n=await OverUnderSync.checkForOverUnderAccount(t);if(n.found&&n.username)return void showOUSyncModal(n,e.user.uid)}goToSegment(2)}else showNotification("Sign in failed. Please try again.","error")}));const t=document.getElementById("skipSignInBtn");t&&t.addEventListener("click",(()=>{Auth.setGuestMode(),goToSegment(2)})),setupOUSyncModal();document.querySelectorAll(".next-btn").forEach((e=>{e.addEventListener("click",(()=>{goToSegment(parseInt(e.dataset.next))}))}));const n=document.getElementById("startTradingBtn");n&&n.addEventListener("click",(()=>{OnboardingState.setCompleted(),hideOnboarding()}));document.querySelectorAll(".progress-dot").forEach((e=>{e.addEventListener("click",(()=>{const t=parseInt(e.dataset.segment);(t<=currentSegment||t===currentSegment+1)&&goToSegment(t)}))}))}function setupAuthUI(){const e=document.getElementById("userMenu"),t=document.getElementById("userAvatar");t&&e&&(t.addEventListener("click",(t=>{t.stopPropagation(),e.classList.toggle("open")})),document.addEventListener("click",(()=>{e.classList.remove("open")})));const n=document.getElementById("headerSignInBtn");n&&n.addEventListener("click",(async()=>{(await Auth.signInWithGoogle()).success&&showNotification("Signed in successfully!","success")}));const a=document.getElementById("signOutBtn");a&&a.addEventListener("click",(async()=>{await Auth.signOut(),showNotification("Signed out","success")}));const o=document.getElementById("modalSignInBtn");o&&o.addEventListener("click",(async()=>{(await Auth.signInWithGoogle()).success&&(hideSignInModal(),showNotification("Signed in! You can now trade.","success"))}));const i=document.getElementById("cancelSignInBtn");i&&i.addEventListener("click",hideSignInModal),setupProfileModal()}function updateAuthUI(e){const t=document.getElementById("userInitials"),n=document.getElementById("userPhoto"),a=document.getElementById("userName"),o=document.getElementById("userEmail"),i=document.getElementById("signOutBtn"),s=document.getElementById("headerSignInBtn"),r=document.getElementById("editProfileBtn"),d=document.getElementById("userAvatar");if(e&&!e.isGuest){const c=UserData.getAvatarStyle(),l=UserData.getDisplayName();if("default"===c&&e.photoURL)n&&(n.src=e.photoURL,n.style.display="block"),t&&(t.style.display="none"),d&&(d.style.background="");else if(c&&c.startsWith("gradient")){if(n&&(n.style.display="none"),t){const e=l?l.split(" ").map((e=>e[0])).join("").toUpperCase().slice(0,2):"?";t.textContent=e,t.style.display="flex"}const e={gradient1:"linear-gradient(135deg, #667eea, #764ba2)",gradient2:"linear-gradient(135deg, #11998e, #38ef7d)",gradient3:"linear-gradient(135deg, #fc4a1a, #f7b733)",gradient4:"linear-gradient(135deg, #141e30, #243b55)",gradient5:"linear-gradient(135deg, #ff9a9e, #fecfef)",gradient6:"linear-gradient(135deg, #00c853, #00e676)",gradient7:"linear-gradient(135deg, #232526, #414345)"};d&&(d.style.background=e[c]||"")}else{if(n&&e.photoURL)n.src=e.photoURL,n.style.display="block",t&&(t.style.display="none");else if(t){const e=l?l.split(" ").map((e=>e[0])).join("").toUpperCase().slice(0,2):"?";t.textContent=e,t.style.display="flex",n&&(n.style.display="none")}d&&(d.style.background="")}a&&(a.textContent=l||"User"),o&&(o.textContent=e.email||""),i&&(i.style.display="flex"),r&&(r.style.display="flex"),s&&(s.style.display="none")}else t&&(t.textContent=e?.isGuest?"G":"?",t.style.display="flex"),n&&(n.style.display="none"),d&&(d.style.background=""),a&&(a.textContent=e?.isGuest?"Guest":"Not signed in"),o&&(o.textContent=e?.isGuest?"Browsing only":"Sign in to trade"),i&&(i.style.display="none"),r&&(r.style.display="none"),s&&(s.style.display="flex")}function showSignInModal(){const e=document.getElementById("signinRequiredModal");e&&e.classList.add("active")}function hideSignInModal(){const e=document.getElementById("signinRequiredModal");e&&e.classList.remove("active")}function showBetaModal(){const e=document.getElementById("betaModal");if(e){e.classList.add("active");const t=document.getElementById("dismissBetaBtn");t&&(t.onclick=()=>{e.classList.remove("active")}),e.onclick=t=>{t.target===e&&e.classList.remove("active")}}}const UPDATES=[{version:"1.1.2",date:"2026-02-03",changes:["Rock Paper Scissors game is now out in the casino!","Market orders are now fixed","Cards are now more valuable","Starter packs now cost real money"]}],LAST_SEEN_UPDATE_KEY="mulon_last_seen_update";function getLastSeenUpdate(){return localStorage.getItem(LAST_SEEN_UPDATE_KEY)||"0.0.0"}function setLastSeenUpdate(e){localStorage.setItem(LAST_SEEN_UPDATE_KEY,e)}function getUnseenUpdates(){const e=getLastSeenUpdate();return UPDATES.filter((t=>compareVersions(t.version,e)>0))}function compareVersions(e,t){const n=e.split(".").map(Number),a=t.split(".").map(Number);for(let e=0;e<Math.max(n.length,a.length);e++){const t=n[e]||0,o=a[e]||0;if(t>o)return 1;if(t<o)return-1}return 0}function checkForUpdates(){const e=getUnseenUpdates();e.length>0&&showUpdateModal(e)}function showUpdateModal(e){let t=document.getElementById("updateModal");if(!t&&(t=document.createElement("div"),t.id="updateModal",t.className="modal-overlay",t.innerHTML='\n      <div class="modal update-modal">\n        <div class="modal-header">\n          <h2>üéâ What\'s New</h2>\n          <button class="modal-close" id="closeUpdateModal">&times;</button>\n        </div>\n        <div class="modal-body" id="updateModalBody">\n        </div>\n        <div class="modal-footer">\n          <button class="btn btn-primary" id="dismissUpdateBtn">Got it!</button>\n        </div>\n      </div>\n    ',document.body.appendChild(t),!document.getElementById("updateModalStyles"))){const e=document.createElement("style");e.id="updateModalStyles",e.textContent="\n        .update-modal {\n          max-width: 420px;\n          width: 90%;\n        }\n        .update-modal .modal-body {\n          padding: 1.5rem;\n          max-height: 400px;\n          overflow-y: auto;\n        }\n        .update-version {\n          margin-bottom: 1.25rem;\n        }\n        .update-version:last-child {\n          margin-bottom: 0;\n        }\n        .update-version-header {\n          display: flex;\n          align-items: center;\n          gap: 0.75rem;\n          margin-bottom: 0.75rem;\n        }\n        .update-version-tag {\n          background: var(--green-primary);\n          color: white;\n          padding: 0.25rem 0.6rem;\n          border-radius: var(--radius-full);\n          font-size: 0.75rem;\n          font-weight: 600;\n        }\n        .update-version-date {\n          color: var(--text-muted);\n          font-size: 0.8rem;\n        }\n        .update-changes {\n          list-style: none;\n          padding: 0;\n          margin: 0;\n        }\n        .update-changes li {\n          display: flex;\n          align-items: flex-start;\n          gap: 0.5rem;\n          padding: 0.4rem 0;\n          color: var(--text-primary);\n          font-size: 0.9rem;\n        }\n        .update-changes li::before {\n          content: '‚ú®';\n          flex-shrink: 0;\n        }\n      ",document.head.appendChild(e)}document.getElementById("updateModalBody").innerHTML=e.map((e=>`\n    <div class="update-version">\n      <div class="update-version-header">\n        <span class="update-version-tag">v${e.version}</span>\n        <span class="update-version-date">${e.date}</span>\n      </div>\n      <ul class="update-changes">\n        ${e.changes.map((e=>`<li>${e}</li>`)).join("")}\n      </ul>\n    </div>\n  `)).join(""),t.classList.add("active");const n=document.getElementById("dismissUpdateBtn"),a=document.getElementById("closeUpdateModal"),o=()=>{t.classList.remove("active");setLastSeenUpdate(e[0].version)};n.onclick=o,a.onclick=o,t.onclick=e=>{e.target===t&&o()}}let selectedAvatarStyle="default";function setupProfileModal(){const e=document.getElementById("editProfileBtn"),t=document.getElementById("profileModal"),n=document.getElementById("closeProfileModal"),a=document.getElementById("cancelProfileBtn"),o=document.getElementById("saveProfileBtn"),i=document.querySelectorAll(".avatar-option"),s=document.getElementById("profileUsername");e&&e.addEventListener("click",(()=>{openProfileModal()})),n&&n.addEventListener("click",closeProfileModalFn),a&&a.addEventListener("click",closeProfileModalFn),t&&t.addEventListener("click",(e=>{e.target===t&&closeProfileModalFn()})),i.forEach((e=>{e.addEventListener("click",(()=>{i.forEach((e=>e.classList.remove("selected"))),e.classList.add("selected"),selectedAvatarStyle=e.dataset.avatar,updateProfilePreview()}))})),s&&s.addEventListener("input",updateProfilePreview),o&&o.addEventListener("click",(async()=>{const e=s.value.trim();if(0===e.length)return void showNotification("Please enter a display name","error");if(e.length>20)return void showNotification("Display name must be 20 characters or less","error");o.disabled=!0,o.textContent="Saving...";(await UserData.updateProfile(e,selectedAvatarStyle)).success?(showNotification("Profile updated!","success"),closeProfileModalFn(),updateAuthUI(Auth.getUser())):showNotification("Failed to update profile","error"),o.disabled=!1,o.textContent="Save Changes"}))}function openProfileModal(){const e=document.getElementById("profileModal"),t=document.getElementById("profileUsername"),n=document.querySelectorAll(".avatar-option");if(!e)return;const a=UserData.getDisplayName(),o=UserData.getAvatarStyle();t&&(t.value=a||""),selectedAvatarStyle=o||"default",n.forEach((e=>{e.classList.toggle("selected",e.dataset.avatar===selectedAvatarStyle)})),updateProfilePreview(),e.classList.add("active")}function closeProfileModalFn(){const e=document.getElementById("profileModal");e&&e.classList.remove("active")}function updateProfilePreview(){const e=document.getElementById("profilePreviewInitials"),t=document.getElementById("profilePreviewPhoto"),n=document.getElementById("profileAvatarPreview"),a=document.getElementById("profileUsername"),o=Auth.getUser(),i=a?.value||UserData.getDisplayName()||"User",s=i?i.split(" ").map((e=>e[0])).join("").toUpperCase().slice(0,2):"?",r={gradient1:"linear-gradient(135deg, #667eea, #764ba2)",gradient2:"linear-gradient(135deg, #11998e, #38ef7d)",gradient3:"linear-gradient(135deg, #fc4a1a, #f7b733)",gradient4:"linear-gradient(135deg, #141e30, #243b55)",gradient5:"linear-gradient(135deg, #ff9a9e, #fecfef)",gradient6:"linear-gradient(135deg, #00c853, #00e676)",gradient7:"linear-gradient(135deg, #232526, #414345)"};"default"===selectedAvatarStyle&&o?.photoURL?(t&&(t.src=o.photoURL,t.style.display="block"),e&&(e.style.display="none"),n&&(n.style.background="")):selectedAvatarStyle.startsWith("gradient")?(t&&(t.style.display="none"),e&&(e.textContent=s,e.style.display="flex"),n&&(n.style.background=r[selectedAvatarStyle]||"")):(t&&(t.style.display="none"),e&&(e.textContent=s,e.style.display="flex"),n&&(n.style.background=""))}function showOUSyncModal(e,t){const n=document.getElementById("ouSyncModal"),a=document.getElementById("ouSyncUsername");n&&a&&(a.textContent=e.username,pendingOUSyncData={mulonUserId:t,username:e.username,name:e.name},n.classList.add("active"))}function hideOUSyncModal(){const e=document.getElementById("ouSyncModal");e&&e.classList.remove("active"),pendingOUSyncData=null}function setupOUSyncModal(){const e=document.getElementById("ouSyncYes"),t=document.getElementById("ouSyncNo");e&&e.addEventListener("click",(async()=>{if(pendingOUSyncData){(await OverUnderSync.syncUsername(pendingOUSyncData.mulonUserId,pendingOUSyncData.username)).success&&showNotification(`Welcome back, ${pendingOUSyncData.username}!`,"success")}hideOUSyncModal(),goToSegment(2)})),t&&t.addEventListener("click",(()=>{hideOUSyncModal(),goToSegment(2)}))}function canTrade(){return Auth.isSignedIn()}function showLoading(){const e=document.getElementById("featuredContainer"),t=document.getElementById("marketGrid");e&&(e.innerHTML='<div class="loading">Loading markets...</div>'),t&&(t.innerHTML="")}function renderNavCategories(){const e=document.getElementById("navCategories");if(!e)return;const t=MulonData.getCategories(),n=getCurrentCategory();injectCategoryStyles(t),e.innerHTML=Object.entries(t).map((([e,t])=>`\n    <li><a href="index.html?cat=${e}" class="cat-pill ${e} ${n===e?"active":""}">${t.icon} ${t.label}</a></li>\n  `)).join(""),updateNavLinksActive()}function getCurrentCategory(){return new URLSearchParams(window.location.search).get("cat")||null}function updateNavLinksActive(){const e=getCurrentCategory(),t=window.location.pathname;document.querySelectorAll(".nav-links .nav-link").forEach((n=>{n.classList.remove("active");const a=n.getAttribute("href");t.includes("leaderbaord")&&a.includes("leaderbaord")?n.classList.add("active"):e||t.includes("leaderbaord")||"index.html"!==a?"all"===e&&"index.html?cat=all"===a&&n.classList.add("active"):n.classList.add("active")}))}function injectCategoryStyles(e){let t=document.getElementById("dynamicCategoryStyles");t||(t=document.createElement("style"),t.id="dynamicCategoryStyles",document.head.appendChild(t));const n=[{bg:"rgba(99, 102, 241, 0.1)",color:"#6366f1"},{bg:"rgba(245, 158, 11, 0.1)",color:"#f59e0b"},{bg:"rgba(139, 92, 246, 0.1)",color:"#8b5cf6"},{bg:"rgba(16, 185, 129, 0.1)",color:"#10b981"},{bg:"rgba(236, 72, 153, 0.1)",color:"#ec4899"},{bg:"rgba(14, 165, 233, 0.1)",color:"#0ea5e9"},{bg:"rgba(249, 115, 22, 0.1)",color:"#f97316"},{bg:"rgba(34, 197, 94, 0.1)",color:"#22c55e"}];let a="",o=0;Object.entries(e).forEach((([e,t])=>{const i=n[o%n.length];a+=`\n      .category-tag.${e} { background: ${i.bg}; color: ${i.color}; }\n      .cat-pill.${e} { background: ${i.bg}; color: ${i.color}; }\n      .cat-pill.${e}:hover { background: ${i.bg.replace("0.1","0.2")}; }\n    `,o++})),t.textContent=a}let modal,closeBtn,modalTitle,modalChoice,yesPrice,noPrice,priceYesBtn,priceNoBtn,amountInput,oddsValue,payoutValue,buyBtn,modalTabs,currentSlide=0,featuredMarketsData=[];function renderMarkets(){const e=getCurrentCategory();let t=MulonData.getActiveMarkets();const n=e&&"all"!==e;n&&(t=t.filter((t=>t.category===e))),updateSectionTitles(e);const a=document.querySelector(".section:first-of-type"),o=document.getElementById("featuredContainer"),i=document.getElementById("marketGrid");if(n||"all"===e)a&&(a.style.display="none"),i&&(t.length>0?i.innerHTML=t.map((e=>renderMarketCard(e))).join(""):i.innerHTML='<div class="empty-state">No markets in this category.</div>');else{a&&(a.style.display="block");const e=t.filter((e=>e.featured)),n=t.filter((e=>!e.featured));if(featuredMarketsData=e.length>0?e:t.length>0?[t[0]]:[],o&&(featuredMarketsData.length>0?(o.innerHTML=renderFeaturedSlider(featuredMarketsData),setupSlider(),window.innerWidth>=900&&loadAndRenderPriceGraphs()):o.innerHTML='<div class="empty-state">No markets available yet.</div>'),i){const a=e.length>0?n:t.slice(1);a.length>0?i.innerHTML=a.map((e=>renderMarketCard(e))).join(""):i.innerHTML=""}}attachBetButtonListeners()}function updateSectionTitles(e){const t=document.querySelector(".section-title"),n=document.querySelectorAll(".section-title")[1];if(e&&"all"!==e){const t=MulonData.getCategory(e);n&&(n.textContent=`${t.icon} ${t.label} Markets`)}else"all"===e?(t&&(t.textContent="üìä Featured Markets"),n&&(n.textContent="All Markets")):(t&&(t.textContent="üî• Trending Markets"),n&&(n.textContent="üìä All Markets"))}function renderFeaturedSlider(e){const t=e.map(((e,t)=>renderFeaturedSlide(e,t))).join(""),n=e.length>1?`\n    <div class="slider-dots">\n      ${e.map(((e,t)=>`<button class="slider-dot ${0===t?"active":""}" data-slide="${t}"></button>`)).join("")}\n    </div>\n  `:"";return`\n    <div class="featured-slider">\n      ${e.length>1?'\n        <button class="slider-arrow slider-prev" aria-label="Previous">\n          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n            <polyline points="15 18 9 12 15 6"></polyline>\n          </svg>\n        </button>\n      ':""}\n      <div class="slider-track">\n        ${t}\n      </div>\n      ${e.length>1?'\n        <button class="slider-arrow slider-next" aria-label="Next">\n          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n            <polyline points="9 18 15 12 9 6"></polyline>\n          </svg>\n        </button>\n      ':""}\n      ${n}\n    </div>\n  `}function renderFeaturedSlide(e,t){const n=MulonData.getCategory(e.category),a=new Date>new Date(`${e.endDate}T${e.endTime||"23:59"}`),o=!0===e.resolved,i=a&&!o,s=UserData.getPositions().find((t=>t.marketId===e.id)),r=!!s,d=!o&&!i&&!r;let c="";if(o){const t="yes"===e.resolvedOutcome?"‚úì YES Won":"‚úó NO Won";c=`<span class="market-result ${e.resolvedOutcome}">${t}</span>`}else i&&(c='<span class="market-result pending">‚è≥ Awaiting Result</span>');return`\n    <div class="featured-slide ${0===t?"active":""}" data-slide-index="${t}">\n      <div class="featured-card ${o?"resolved":""} ${i?"pending":""}" data-market-id="${e.id}">\n        <div class="featured-card-main">\n          <div class="featured-card-info">\n            <div class="card-header">\n              <div class="card-category">\n                <span class="category-tag ${e.category}">${n.icon} ${n.label}</span>\n                <span class="volume">${MulonData.formatVolume(e.volume)}</span>\n              </div>\n              <div class="card-time">\n                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                  <circle cx="12" cy="12" r="10"></circle>\n                  <polyline points="12 6 12 12 16 14"></polyline>\n                </svg>\n                <span>${MulonData.getDaysUntil(e.endDate)}${e.endTime?" @ "+e.endTime:""}</span>\n              </div>\n            </div>\n            <h3 class="card-title">${e.title}</h3>\n            <p class="card-subtitle">${e.subtitle||""}</p>\n            ${c}\n            \n            <div class="probability-bar">\n              <div class="prob-fill" style="width: ${e.yesPrice}%;"></div>\n            </div>\n            <div class="prob-labels">\n              <span class="prob-yes">${e.yesPrice}% Yes</span>\n              <span class="prob-no">${e.noPrice}% No</span>\n            </div>\n          </div>\n          \n          <div class="featured-card-graph" data-market-id="${e.id}">\n            <div class="graph-header">\n              <span class="graph-price">${e.yesPrice}%</span>\n              <span class="graph-label">probability</span>\n            </div>\n            <div class="graph-container">\n              <svg class="price-graph" data-market-id="${e.id}" viewBox="0 0 200 80" preserveAspectRatio="none">\n                <defs>\n                  <linearGradient id="graphGradient-${e.id}" x1="0%" y1="0%" x2="0%" y2="100%">\n                    <stop offset="0%" stop-color="var(--green-primary)" stop-opacity="0.3"/>\n                    <stop offset="100%" stop-color="var(--green-primary)" stop-opacity="0.02"/>\n                  </linearGradient>\n                </defs>\n                <path class="graph-area" fill="url(#graphGradient-${e.id})" d=""></path>\n                <path class="graph-line" fill="none" stroke="var(--green-primary)" stroke-width="2" d=""></path>\n              </svg>\n              <div class="graph-loading">Loading...</div>\n            </div>\n            <div class="graph-dates">\n              <span class="graph-date-start"></span>\n              <span class="graph-date-end">Now</span>\n            </div>\n          </div>\n        </div>\n\n        ${d?`\n          <div class="bet-buttons">\n            <button class="bet-btn yes" data-market-id="${e.id}" data-choice="yes">\n              <div class="bet-label">Yes</div>\n              <div class="bet-price">${e.yesPrice}¬¢</div>\n            </button>\n            <button class="bet-btn no" data-market-id="${e.id}" data-choice="no">\n              <div class="bet-label">No</div>\n              <div class="bet-price">${e.noPrice}¬¢</div>\n            </button>\n          </div>\n          <div class="payout-info">\n            <span class="payout yes-payout">$100 ‚Üí $${Math.round(100/(e.yesPrice/100))}</span>\n            <span class="payout no-payout">$100 ‚Üí $${Math.round(100/(e.noPrice/100))}</span>\n          </div>\n        `:r?`\n          <div class="user-position-display ${s.choice}">\n            <div class="position-badge ${s.choice}">\n              <span class="position-icon">${"yes"===s.choice?"‚úì":"‚úó"}</span>\n              <span class="position-label">You picked ${s.choice.toUpperCase()}</span>\n            </div>\n            <div class="position-details">\n              <span>${s.shares} shares @ ${s.avgPrice}¬¢</span>\n            </div>\n          </div>\n        `:`\n          <div class="market-closed-notice">\n            ${o?"Market Resolved":"Betting Closed"}\n          </div>\n        `}\n      </div>\n    </div>\n  `}async function loadAndRenderPriceGraphs(){const e=document.querySelectorAll(".featured-card-graph");for(const t of e){const e=t.dataset.marketId;if(e)try{const n=await OrderBook.getRecentTrades(e,0);renderPriceGraph(t,n,MulonData.getMarket(e))}catch(n){console.warn("Error loading price graph for market",e,n),t.querySelector(".graph-loading").textContent="No data"}}}function renderPriceGraph(e,t,n){const a=e.querySelector(".price-graph"),o=e.querySelector(".graph-loading"),i=e.querySelector(".graph-date-start"),s=a.querySelector(".graph-line"),r=a.querySelector(".graph-area");if(!a||!n)return;let d=[];const c=n.createdAt?new Date(n.createdAt):new Date(Date.now()-6048e5);if(d.push({timestamp:c,price:50}),t.length>0){[...t].sort(((e,t)=>new Date(e.timestamp)-new Date(t.timestamp))).forEach((e=>{let t;t=void 0!==e.priceAfter?"yes"===e.choice?e.priceAfter:100-e.priceAfter:"yes"===e.choice?e.price:100-e.price,d.push({timestamp:new Date(e.timestamp),price:t})}))}if(d.push({timestamp:new Date,price:n.yesPrice}),d.length>0&&i){const e=d[0].timestamp;i.textContent=e.toLocaleDateString("en-US",{month:"short",day:"numeric"})}const l=d[0].timestamp.getTime(),u=d[d.length-1].timestamp.getTime()-l||1,m=d.map((e=>({x:2+(e.timestamp.getTime()-l)/u*196,y:78-(e.price-0)/100*76})));let g="",p="";if(m.length>1){g=`M ${m[0].x} ${m[0].y}`;for(let e=1;e<m.length;e++)g+=` L ${m[e].x} ${m[e].y}`;p=g+` L ${m[m.length-1].x} 80 L ${m[0].x} 80 Z`}s.setAttribute("d",g),r.setAttribute("d",p),o&&(o.style.display="none")}function setupSlider(){const e=document.querySelector(".slider-prev"),t=document.querySelector(".slider-next"),n=document.querySelectorAll(".slider-dot");e&&e.addEventListener("click",(()=>goToSlide(currentSlide-1))),t&&t.addEventListener("click",(()=>goToSlide(currentSlide+1))),n.forEach((e=>{e.addEventListener("click",(()=>{goToSlide(parseInt(e.dataset.slide))}))}));const a=document.querySelector(".slider-track");if(a){let e=0,t=!1;a.addEventListener("touchstart",(n=>{e=n.touches[0].clientX,t=!0})),a.addEventListener("touchend",(n=>{if(!t)return;const a=n.changedTouches[0].clientX,o=e-a;Math.abs(o)>50&&goToSlide(o>0?currentSlide+1:currentSlide-1),t=!1}))}}function goToSlide(e){const t=document.querySelectorAll(".featured-slide"),n=document.querySelectorAll(".slider-dot");0!==t.length&&(e<0&&(e=t.length-1),e>=t.length&&(e=0),currentSlide=e,t.forEach(((t,n)=>{t.classList.toggle("active",n===e)})),n.forEach(((t,n)=>{t.classList.toggle("active",n===e)})))}function renderMarketCard(e){const t=MulonData.getCategory(e.category),n=new Date>new Date(`${e.endDate}T${e.endTime||"23:59"}`),a=!0===e.resolved,o=n&&!a,i=UserData.getPositions().find((t=>t.marketId===e.id)),s=!!i,r=!a&&!o&&!s;let d="";if(a){const t="yes"===e.resolvedOutcome?"‚úì YES":"‚úó NO";d=`<span class="card-status resolved ${e.resolvedOutcome}">${t}</span>`}else o&&(d='<span class="card-status pending">‚è≥ Pending</span>');return`\n    <div class="market-card ${a?"resolved":""} ${o?"pending":""}" data-market-id="${e.id}">\n      <div class="card-category">\n        <span class="category-tag ${e.category}">${t.icon} ${t.label}</span>\n        ${d}\n      </div>\n      <h4 class="card-title">${e.title}</h4>\n      ${e.subtitle?`<p class="card-description">${e.subtitle}</p>`:""}\n      <div class="card-meta">\n        <span class="card-volume">${MulonData.formatVolume(e.volume)}</span>\n        <span class="card-time-text">Ends ${MulonData.formatDate(e.endDate)}${e.endTime?" @ "+e.endTime:""}</span>\n      </div>\n      <div class="probability-bar small">\n        <div class="prob-fill" style="width: ${e.yesPrice}%;"></div>\n      </div>\n      ${r?`\n        <div class="bet-buttons compact">\n          <button class="bet-btn yes compact" data-market-id="${e.id}" data-choice="yes">\n            <span>Yes</span>\n            <span class="price">${e.yesPrice}¬¢</span>\n          </button>\n          <button class="bet-btn no compact" data-market-id="${e.id}" data-choice="no">\n            <span>No</span>\n            <span class="price">${e.noPrice}¬¢</span>\n          </button>\n        </div>\n      `:s?`\n        <div class="user-position-compact ${i.choice}">\n          <span class="position-icon">${"yes"===i.choice?"‚úì":"‚úó"}</span>\n          <span>You picked ${i.choice.toUpperCase()}</span>\n        </div>\n      `:`\n        <div class="market-closed-compact">\n          ${a?"Resolved":"Closed"}\n        </div>\n      `}\n    </div>\n  `}let currentChoice="yes",currentYesPrice=69,currentNoPrice=31,currentMarketId=null;function setupModal(){modal=document.getElementById("betModal"),closeBtn=document.getElementById("closeModal"),modalTitle=document.getElementById("modalTitle"),modalChoice=document.getElementById("modalChoice"),yesPrice=document.getElementById("yesPrice"),noPrice=document.getElementById("noPrice"),priceYesBtn=document.getElementById("priceYes"),priceNoBtn=document.getElementById("priceNo"),amountInput=document.getElementById("amountInput"),oddsValue=document.getElementById("oddsValue"),payoutValue=document.getElementById("payoutValue"),buyBtn=document.getElementById("buyBtn"),modalTabs=document.querySelectorAll(".modal-tab"),closeBtn&&closeBtn.addEventListener("click",closeModal),modal&&modal.addEventListener("click",(function(e){e.target===modal&&closeModal()})),document.addEventListener("keydown",(function(e){"Escape"===e.key&&modal&&modal.classList.contains("active")&&closeModal()})),priceYesBtn&&priceYesBtn.addEventListener("click",(function(){currentChoice="yes",updateModalChoice(),updatePayout()})),priceNoBtn&&priceNoBtn.addEventListener("click",(function(){currentChoice="no",updateModalChoice(),updatePayout()})),amountInput&&amountInput.addEventListener("input",updatePayout),modalTabs.forEach((e=>{e.addEventListener("click",(function(){modalTabs.forEach((e=>e.classList.remove("active"))),this.classList.add("active"),updatePayout()}))})),buyBtn&&buyBtn.addEventListener("click",(async function(){if(!canTrade())return void showSignInModal();const e=parseFloat(amountInput.value)||0;if(e<=0)return void showNotification("Please enter a valid amount","error");if(e<.1)return void showNotification("Minimum order is $0.10","error");if(e>UserData.getBalance())return void showNotification("Insufficient balance!","error");const t=MulonData.getMarket(currentMarketId);if(t){buyBtn.disabled=!0,buyBtn.textContent="Processing...";try{const n=Auth.getUser()?.uid||"anonymous",a=await OrderBook.executeMarketOrder(currentMarketId,"buy",currentChoice,e,n);if(!a.filled)return void showNotification(a.error||"Order could not be filled","error");await UserData.updateBalance(-e),await UserData.addPosition(currentMarketId,t.title,currentChoice,a.shares,e,a.avgPrice);const o=0!==a.priceChange?` (${a.priceChange>0?"+":""}${a.priceChange}¬¢)`:"";showNotification(`Bought ${a.shares} ${currentChoice.toUpperCase()} @ ${a.avgPrice}¬¢${o} ‚Üí Now ${a.newPrice}¬¢`,"success"),updateUserUI(),renderMarkets(),closeModal()}catch(e){console.error("Order execution error:",e),showNotification("Order failed. Please try again.","error")}finally{buyBtn.disabled=!1,buyBtn.textContent="Buy"}}else showNotification("Market not found","error")}))}function attachBetButtonListeners(){document.querySelectorAll(".bet-btn").forEach((e=>{e.addEventListener("click",(function(e){e.stopPropagation();const t=this.dataset.marketId,n=this.dataset.choice,a=MulonData.getMarket(t);if(!a)return;currentMarketId=t,currentYesPrice=a.yesPrice,currentNoPrice=a.noPrice,currentChoice=n;const o=MulonData.getCategory(a.category);modalTitle&&(modalTitle.textContent=a.title),document.querySelector(".modal-market-icon").textContent=o.icon,yesPrice&&(yesPrice.textContent=a.yesPrice+"¬¢"),noPrice&&(noPrice.textContent=a.noPrice+"¬¢"),updateModalChoice(),updatePayout(),modal&&(modal.classList.add("active"),document.body.style.overflow="hidden")}))}));document.querySelectorAll(".market-card").forEach((e=>{e.addEventListener("click",(function(e){if(e.target.closest(".bet-btn"))return;const t=this.querySelector(".bet-btn.yes");t&&t.click()}))}))}function closeModal(){modal&&(modal.classList.remove("active"),document.body.style.overflow="")}function updateModalChoice(){"yes"===currentChoice?(priceYesBtn&&priceYesBtn.classList.add("active"),priceNoBtn&&priceNoBtn.classList.remove("active"),modalChoice&&(modalChoice.textContent="Yes",modalChoice.className="choice-yes"),oddsValue&&(oddsValue.textContent=currentYesPrice+"¬¢")):(priceNoBtn&&priceNoBtn.classList.add("active"),priceYesBtn&&priceYesBtn.classList.remove("active"),modalChoice&&(modalChoice.textContent="No",modalChoice.className="choice-no"),oddsValue&&(oddsValue.textContent=currentNoPrice+"¬¢"))}function updatePayout(){if(!amountInput||!payoutValue)return;const e=parseFloat(amountInput.value)||0,t="yes"===currentChoice?currentYesPrice:currentNoPrice,n=e/(t/100),a=Math.round(n),o=document.getElementById("sharesValue");o&&(o.textContent=n.toFixed(2)),oddsValue&&(oddsValue.textContent=t+"¬¢");const i=MulonData.getMarket(currentMarketId),s=document.getElementById("priceAfterValue"),r=document.getElementById("priceImpactNotice");if(i&&s){const n=i.volume||1e3,a=Math.min(e/n,.15);let o;o=buyBtn&&buyBtn.classList.contains("sell-mode")?Math.max(1,Math.round(t-100*a)):Math.min(99,Math.round(t+100*a));const d=o-t;0!==d?(s.textContent=`${o}¬¢ (${d>0?"+":""}${d})`,s.style.color=d>0?"var(--green-primary)":"var(--red-primary)"):(s.textContent=t+"¬¢",s.style.color="var(--text-primary)"),r&&(Math.abs(d)>=5?(r.style.display="flex",r.classList.toggle("large-impact",Math.abs(d)>=10)):r.style.display="none")}payoutValue.textContent="$"+a,payoutValue.style.color="yes"===currentChoice?"var(--green-primary)":"var(--red-primary)"}function setupSuggestionModal(){const e=document.getElementById("suggestBtn"),t=document.getElementById("suggestModal"),n=document.getElementById("closeSuggestModal"),a=document.getElementById("suggestForm"),o=document.getElementById("suggestCategory");if(o){const e=MulonData.getCategories();Object.entries(e).forEach((([e,t])=>{const n=document.createElement("option");n.value=e,n.textContent=`${t.icon} ${t.label}`,o.appendChild(n)}))}e&&e.addEventListener("click",(()=>{t&&(t.classList.add("active"),document.body.style.overflow="hidden")})),n&&n.addEventListener("click",closeSuggestionModal),t&&t.addEventListener("click",(e=>{e.target===t&&closeSuggestionModal()})),a&&a.addEventListener("submit",(async e=>{if(e.preventDefault(),"function"==typeof window.checkBanStatus){if(await window.checkBanStatus())return}const t=document.getElementById("suggestTitle").value.trim(),n=document.getElementById("suggestCategory").value,o=document.getElementById("suggestReason").value.trim();if(!t)return void showNotification("Please enter a market question","error");const i=Auth.currentUser,s=i?i.uid:null,r=i?i.email:null,d=i?i.displayName:null,c=await MulonData.submitSuggestion(t,n,o,s,r,d);c.success?(showNotification("Thanks! Your suggestion has been submitted.","success"),a.reset(),closeSuggestionModal()):showNotification(c.error||"Error submitting suggestion. Please try again.","error")}))}function closeSuggestionModal(){const e=document.getElementById("suggestModal");e&&(e.classList.remove("active"),document.body.style.overflow="")}function setupSidebar(){const e=document.getElementById("sidebar"),t=document.getElementById("sidebarToggle"),n=document.getElementById("sidebarOverlay"),a=document.querySelectorAll(".sidebar-tab");t&&t.addEventListener("click",(()=>{e.classList.toggle("open"),n.classList.toggle("active"),document.body.classList.toggle("sidebar-open")})),n&&n.addEventListener("click",(()=>{e.classList.remove("open"),n.classList.remove("active"),document.body.classList.remove("sidebar-open")})),a.forEach((e=>{e.addEventListener("click",(()=>{a.forEach((e=>e.classList.remove("active"))),e.classList.add("active");const t=e.dataset.tab;document.querySelectorAll(".sidebar-panel").forEach((e=>{e.classList.remove("active")})),document.getElementById(t+"Panel").classList.add("active")}))}))}function updateUserUI(){updateBalanceDisplay(),updateKeysDisplay(),updatePortfolioDisplay(),updateWatchlistDisplay(),updateCashoutsDisplay()}function updateBalanceDisplay(){const e=document.getElementById("userBalance"),t=UserData.getBalance();e&&(e.textContent=formatBalance(t)),amountInput&&(amountInput.max=t)}function updateKeysDisplay(){const e=document.getElementById("userKeys"),t=UserData.getKeys();e&&(e.innerHTML='<img src="/bp/EE/assets/ouths/key.png" alt="" class="key-icon"> '+t)}function setupKeysTooltip(){const e=document.getElementById("keysInfoBtn"),t=document.getElementById("keysTooltip");e&&t&&(e.addEventListener("click",(e=>{e.stopPropagation(),t.classList.toggle("active")})),document.addEventListener("click",(()=>{t.classList.remove("active")})))}let dailyKeyTimerInterval=null;function setupDailyKeyClaim(){const e=document.getElementById("claimDailyKeyBtn");e&&e.addEventListener("click",(async()=>{if(!Auth.getUser())return void document.getElementById("signinRequiredModal").classList.add("active");const t=await UserData.claimDailyKey();t.success&&(updateKeysDisplay(),updateBalanceDisplay(),updateDailyKeyUI(),showNotification(`üî• Day ${t.streak} Streak! +${t.keysReward} Keys & +$${t.balanceReward} (${t.multiplier}x)`,"success"),e.classList.add("claimed"),e.querySelector(".claim-text").textContent="Claimed!",setTimeout((()=>{e.classList.remove("claimed")}),1e3))}))}function updateDailyKeyUI(){const e=document.getElementById("dailyKeyBox"),t=document.getElementById("claimDailyKeyBtn"),n=document.getElementById("dailyKeyTimer"),a=(document.getElementById("timerValue"),document.getElementById("dailyKeyDesc")),o=document.getElementById("streakFlame"),i=document.getElementById("streakCount"),s=document.getElementById("previewKeys"),r=document.getElementById("previewBalance"),d=document.getElementById("rewardMultiplier"),c=document.getElementById("rewardPreview");if(!Auth.getUser())return void(e&&(e.style.display="none"));e&&(e.style.display="block");const l=UserData.canClaimDailyKey(),u=UserData.getStreakRewardInfo();i&&(i.textContent=u.currentStreak),o&&(u.currentStreak>=7?(o.textContent="üî•",o.style.fontSize="2rem"):u.currentStreak>=3?(o.textContent="üî•",o.style.fontSize="1.5rem"):(o.textContent="‚ú®",o.style.fontSize="1.2rem")),s&&(s.textContent=u.keysReward),r&&(r.textContent=u.balanceReward),d&&(d.textContent=u.multiplier+"x"),l?(t&&(t.style.display="flex",t.disabled=!1,t.querySelector(".claim-text").textContent="Claim Rewards"),n&&(n.style.display="none"),c&&(c.style.display="flex"),a&&(u.currentStreak>0?a.textContent=`Day ${u.nextStreak} reward ready!`:a.textContent="Start your streak!"),dailyKeyTimerInterval&&(clearInterval(dailyKeyTimerInterval),dailyKeyTimerInterval=null)):(t&&(t.style.display="none"),n&&(n.style.display="flex"),c&&(c.style.opacity="0.5"),a&&(a.textContent=`üî• ${u.currentStreak} day streak!`),updateDailyKeyTimer(),dailyKeyTimerInterval||(dailyKeyTimerInterval=setInterval(updateDailyKeyTimer,1e3)))}function updateDailyKeyTimer(){const e=document.getElementById("timerValue"),t=UserData.getTimeUntilNextClaim();if(t<=0)return void updateDailyKeyUI();const n=Math.floor(t/36e5),a=Math.floor(t%36e5/6e4),o=Math.floor(t%6e4/1e3);e&&(e.textContent=String(n).padStart(2,"0")+":"+String(a).padStart(2,"0")+":"+String(o).padStart(2,"0"))}function updatePortfolioDisplay(){const e=UserData.getPositions(),t=document.getElementById("positionsList"),n=document.getElementById("emptyPortfolio"),a=document.getElementById("positionCount"),o=document.getElementById("portfolioValue"),i=document.getElementById("totalValue"),s=document.getElementById("totalPnl");a&&(a.textContent=e.length);let r=0,d=0;e.forEach((e=>{const t=MulonData.getMarket(e.marketId);if(t){const n="yes"===e.choice?t.yesPrice:t.noPrice;r+=e.shares*n/100,d+=e.costBasis}}));const c=r-d,l=UserData.getBalance();if(o&&(o.textContent="$"+r.toFixed(2)),i&&(i.textContent="$"+(l+r).toFixed(2)),s){const e=c>=0?"+":"";s.textContent=e+"$"+c.toFixed(2),s.className="stat-value "+(c>=0?"pnl-positive":"pnl-negative")}if(0===e.length)return n&&(n.style.display="flex"),void(t&&(t.innerHTML=""));n&&(n.style.display="none"),t&&(t.innerHTML=e.map((e=>{const t=MulonData.getMarket(e.marketId),n=t?"yes"===e.choice?t.yesPrice:t.noPrice:e.avgPrice,a=e.shares*n/100,o=a-e.costBasis,i=(100*(a/e.costBasis-1)).toFixed(1),s=!0===t?.resolved;return`\n        <div class="position-item" data-market-id="${e.marketId}">\n          <div class="position-header">\n            <div class="position-market">${e.marketTitle}</div>\n            ${s?'<span class="position-resolved-badge">Resolved</span>':""}\n          </div>\n          <div class="position-details">\n            <div class="position-info">\n              <span class="position-badge ${e.choice}">${e.choice.toUpperCase()}</span>\n              <span class="position-shares">${e.shares.toFixed(2)} shares @ ${e.avgPrice}¬¢</span>\n            </div>\n            <div class="position-value">\n              <div class="position-current">$${a.toFixed(2)}</div>\n              <div class="position-pnl ${o>=0?"positive":"negative"}">\n                ${o>=0?"+":""}$${o.toFixed(2)} (${i}%)\n              </div>\n            </div>\n          </div>\n        </div>\n      `})).join(""))}function updateWatchlistDisplay(){const e=UserData.getWatchlist(),t=document.getElementById("watchlistItems"),n=document.getElementById("emptyWatchlist");if(0===e.length)return n&&(n.style.display="flex"),void(t&&(t.innerHTML=""));n&&(n.style.display="none"),t&&(t.innerHTML=e.map((e=>{const t=MulonData.getMarket(e);if(!t)return"";return`\n        <div class="watchlist-item" data-market-id="${e}">\n          <div class="watchlist-icon">${MulonData.getCategory(t.category).icon}</div>\n          <div class="watchlist-info">\n            <div class="watchlist-title">${t.title}</div>\n            <div class="watchlist-price">\n              <span style="color: var(--green-primary)">Yes ${t.yesPrice}¬¢</span> ¬∑ \n              <span style="color: var(--red-primary)">No ${t.noPrice}¬¢</span>\n            </div>\n          </div>\n          <button class="watchlist-remove" data-market-id="${e}">\n            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n              <line x1="18" y1="6" x2="6" y2="18"></line>\n              <line x1="6" y1="6" x2="18" y2="18"></line>\n            </svg>\n          </button>\n        </div>\n      `})).join(""),t.querySelectorAll(".watchlist-remove").forEach((e=>{e.addEventListener("click",(async t=>{t.stopPropagation(),await UserData.removeFromWatchlist(e.dataset.marketId),updateWatchlistDisplay()}))})),t.querySelectorAll(".watchlist-item").forEach((e=>{e.addEventListener("click",(()=>{const t=e.dataset.marketId,n=MulonData.getMarket(t);if(n){currentMarketId=t,currentYesPrice=n.yesPrice,currentNoPrice=n.noPrice,currentChoice="yes";const e=MulonData.getCategory(n.category);modalTitle&&(modalTitle.textContent=n.title),document.querySelector(".modal-market-icon").textContent=e.icon,yesPrice&&(yesPrice.textContent=n.yesPrice+"¬¢"),noPrice&&(noPrice.textContent=n.noPrice+"¬¢"),updateModalChoice(),updatePayout(),modal&&(modal.classList.add("active"),document.body.style.overflow="hidden")}}))})))}function updateCashoutsDisplay(){const e=UserData.getCashOuts(),t=document.getElementById("cashoutsList"),n=document.getElementById("emptyCashouts"),a=document.getElementById("totalWon"),o=document.getElementById("totalLost"),i=document.getElementById("cashoutCount");let s=0,r=0;if(e.forEach((e=>{e.won?s+=e.payout:r+=e.cost})),a&&(a.textContent="$"+s.toFixed(2)),o&&(o.textContent="$"+r.toFixed(2)),i&&(i.textContent=e.length),0===e.length)return n&&(n.style.display="flex"),void(t&&(t.innerHTML=""));if(n&&(n.style.display="none"),t){const n=[...e].sort(((e,t)=>new Date(t.timestamp)-new Date(e.timestamp)));t.innerHTML=n.map((e=>{const t=MulonData.getMarket(e.marketId),n=t?t.title:e.marketTitle||"Unknown Market",a=e.won?"WON":"LOST",o=e.won?"+$"+e.payout.toFixed(2):"-$"+e.cost.toFixed(2);return`\n        <div class="cashout-item">\n          <div class="cashout-icon ${e.won?"won":"lost"}">\n            ${e.won?"‚úì":"‚úó"}\n          </div>\n          <div class="cashout-details">\n            <div class="cashout-market">${n}</div>\n            <div class="cashout-position">${e.shares} ${e.position.toUpperCase()} shares @ ${e.avgPrice}¬¢</div>\n          </div>\n          <div class="cashout-amount">\n            <div class="cashout-payout ${e.won?"won":"lost"}">${o}</div>\n            <div class="cashout-result ${e.won?"won":"lost"}">${a}</div>\n          </div>\n        </div>\n      `})).join("")}}function showNotification(e,t="success"){const n=document.querySelector(".notification");n&&n.remove();const a=document.createElement("div");a.className=`notification ${t}`,a.innerHTML=`\n    <span>${e}</span>\n    <button class="notification-close">√ó</button>\n  `,document.body.appendChild(a),setTimeout((()=>a.classList.add("show")),10),a.querySelector(".notification-close").addEventListener("click",(()=>{a.classList.remove("show"),setTimeout((()=>a.remove()),300)})),setTimeout((()=>{a.classList.remove("show"),setTimeout((()=>a.remove()),300)}),4e3)}function checkForUnseenWins(){const e=UserData.getUnseenWins();e.length>0&&showWinCelebration(e)}function showWinCelebration(e){const t=document.getElementById("winCelebrationOverlay"),n=document.getElementById("winModalBody"),a=document.getElementById("winModalOkBtn"),o=document.getElementById("confettiContainer");if(!t||!n)return;createConfetti(o),n.innerHTML=e.map((e=>`\n      <div class="win-item">\n        <div class="win-item-icon">üéâ</div>\n        <div class="win-item-details">\n          <div class="win-item-market">${e.marketTitle||"Market"}</div>\n          <div class="win-item-info">${e.shares} ${e.position.toUpperCase()} shares</div>\n        </div>\n        <div class="win-item-payout">+$${e.payout.toFixed(2)}</div>\n      </div>\n    `)).join("");const i=e.reduce(((e,t)=>e+t.payout),0);e.length>1&&(n.innerHTML+=`\n      <div class="win-item" style="background: linear-gradient(135deg, rgba(0, 200, 83, 0.1), rgba(0, 200, 83, 0.05)); border-left-color: gold;">\n        <div class="win-item-icon">üí∞</div>\n        <div class="win-item-details">\n          <div class="win-item-market">Total Winnings</div>\n          <div class="win-item-info">${e.length} winning positions</div>\n        </div>\n        <div class="win-item-payout" style="color: gold;">+$${i.toFixed(2)}</div>\n      </div>\n    `),t.classList.add("active"),a.onclick=async()=>{const n=e.map((e=>e.marketId+"_"+e.timestamp));await UserData.markCashoutsAsSeen(n),t.classList.remove("active"),o.innerHTML=""}}function createConfetti(e){if(!e)return;const t=["#00c853","#ffd700","#ff4757","#3b82f6","#8b5cf6","#f59e0b","#ec4899"],n=["square","circle"];for(let a=0;a<150;a++){const a=document.createElement("div");a.className="confetti";const o=t[Math.floor(Math.random()*t.length)],i=n[Math.floor(Math.random()*n.length)],s=100*Math.random(),r=2*Math.random(),d=8*Math.random()+6,c=2*Math.random()+2;a.style.cssText=`\n      left: ${s}%;\n      width: ${d}px;\n      height: ${d}px;\n      background: ${o};\n      border-radius: ${"circle"===i?"50%":"2px"};\n      animation-delay: ${r}s;\n      animation-duration: ${c}s;\n    `,e.appendChild(a)}}